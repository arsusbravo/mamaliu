import{d as B,j as S,k as W,m as me,c as m,b as t,f as C,H as D,t as i,a as o,u as e,F as T,r as N,e as L,o as a,v as G,B as re,w as l,g,I as Q,K as le,x as ve,L as oe,i as P,h as fe}from"./app-BWjfSfKw.js";import{_ as pe}from"./AppLayout.vue_vue_type_script_setup_true_lang-BVjWeG2X.js";import{a as I,_ as q}from"./Label.vue_vue_type_script_setup_true_lang-CP35pHrN.js";import{c as ne,_ as j}from"./index-Y70dRWaC.js";import{_ as R,a as X,b as K,c as Z,d as J}from"./DialogTitle.vue_vue_type_script_setup_true_lang-O5AZRL8s.js";import{_ as ye}from"./Textarea.vue_vue_type_script_setup_true_lang-DfeRo90E.js";import{C as xe}from"./check-CwrPA0hB.js";import{_ as be}from"./FormWeekmenu.vue_vue_type_script_setup_true_lang-B4paVQMJ.js";import{X as ge}from"./x-DUDa84Az.js";import{_ as we,a as ke}from"./CardContent.vue_vue_type_script_setup_true_lang-mCdqzvMU.js";import{_ as _e}from"./CardDescription.vue_vue_type_script_setup_true_lang-DS-K10UE.js";import{_ as $e,a as he}from"./CardTitle.vue_vue_type_script_setup_true_lang-C2GhnzjR.js";import{S as Ce}from"./search-Dq4BXMwK.js";import"./Presence-C8gedXCe.js";import"./VisuallyHidden-C395VrXH.js";import"./index-B8We5vQ-.js";import"./shopping-bag-BA7BpGd2.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-Cv46GpO0.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CIRX1hX0.js";import"./useFormControl-27ZQJrxb.js";import"./image-off-D-cK2CQ6.js";const Ve=ne("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Se=ne("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Ue={class:"grid gap-2"},qe=["disabled"],Fe={key:0,class:"flex flex-col"},Oe={class:"font-medium"},De={class:"text-xs text-muted-foreground"},Me={key:1,class:"text-muted-foreground"},Te={key:0,class:"relative"},je={class:"absolute z-50 w-full mt-1 bg-background border rounded-md shadow-lg"},Ie={class:"p-2 border-b"},Ae={class:"max-h-64 overflow-y-auto"},Ee={class:"p-1"},Ne=["onClick"],We={class:"flex flex-col text-left"},Pe={class:"font-medium"},Le={class:"text-xs text-muted-foreground"},ze={key:0,class:"p-4 text-center text-muted-foreground"},Be={key:1,class:"text-sm text-red-500"},ae=B({__name:"ClientSelector",props:{modelValue:{default:null},error:{default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(u,{emit:F}){const y=u,U=F,v=S(""),b=S(!1),k=S([]),V=W(()=>!y.modelValue||!k.value?null:k.value.find(_=>_.id===y.modelValue)),p=W(()=>{if(!v.value)return k.value;const _=v.value.toLowerCase();return k.value.filter(r=>r.name.toLowerCase().includes(_)||r.email.toLowerCase().includes(_))}),d=async()=>{try{const r=await(await fetch("/admin/clients/list")).json();k.value=r.clients||[]}catch(_){console.error("Failed to load clients:",_)}},O=_=>{U("update:modelValue",_),b.value=!1,v.value=""},A=()=>{y.disabled||(b.value=!b.value,b.value&&k.value.length===0&&d())};return me(()=>{y.modelValue&&d()}),(_,r)=>(a(),m("div",Ue,[t("button",{type:"button",onClick:A,disabled:u.disabled,class:D(["flex items-center justify-between gap-3 w-full px-3 py-2 text-left border rounded-md bg-background hover:bg-accent",u.error?"border-red-500":"border-input",u.disabled?"opacity-50 cursor-not-allowed":""])},[V.value?(a(),m("div",Fe,[t("span",Oe,i(V.value.name),1),t("span",De,i(V.value.email),1)])):(a(),m("span",Me,"Select a client")),r[1]||(r[1]=t("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))],10,qe),b.value?(a(),m("div",Te,[t("div",je,[t("div",Ie,[o(e(I),{modelValue:v.value,"onUpdate:modelValue":r[0]||(r[0]=s=>v.value=s),type:"text",placeholder:"Search by name or email...",class:"w-full"},null,8,["modelValue"])]),t("div",Ae,[t("div",Ee,[(a(!0),m(T,null,N(p.value,s=>(a(),m("button",{key:s.id,type:"button",onClick:w=>O(s.id),class:"flex items-center justify-between w-full px-3 py-2 rounded hover:bg-accent transition-colors"},[t("div",We,[t("span",Pe,i(s.name),1),t("span",Le,i(s.email),1)]),s.id===u.modelValue?(a(),L(e(xe),{key:0,class:"w-4 h-4 text-primary shrink-0"})):C("",!0)],8,Ne))),128)),p.value.length===0?(a(),m("div",ze," No clients found ")):C("",!0)])])])])):C("",!0),u.error?(a(),m("span",Be,i(u.error),1)):C("",!0)]))}}),Ye={class:"grid grid-cols-2 gap-4"},He={key:0,class:"text-sm text-red-500 mt-1"},Ge={key:0,class:"text-sm text-red-500 mt-1"},Qe={class:"flex items-center justify-between mb-2"},Re=["value"],Xe={key:0,class:"text-sm text-red-500 mt-1"},Ke={key:1,class:"text-sm text-muted-foreground mt-1"},Ze={key:0,class:"text-sm text-red-500 mt-1"},Je={class:"flex justify-end gap-2"},de=B({__name:"FormOrder",props:{order:{default:null},user_id:{default:null},week:{},year:{},menus:{},groups:{}},emits:["success","cancel"],setup(u,{emit:F}){const y=u,U=F,v=S([]),b=S(!1),k=S(!1),V=new Date,p=r=>{const s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())),w=s.getUTCDay()||7;s.setUTCDate(s.getUTCDate()+4-w);const M=new Date(Date.UTC(s.getUTCFullYear(),0,1));return Math.ceil(((s.getTime()-M.getTime())/864e5+1)/7)},d=G({user_id:y.order?.user_id||y.user_id||null,weekmenu_id:y.order?.weekmenu_id||null,quantity:y.order?.quantity||1,notes:y.order?.notes||"",week:y.order?.week||y.week||p(V),year:y.order?.year||y.year||V.getFullYear()}),O=async()=>{try{b.value=!0;const s=await(await fetch(`/admin/weekmenus/list?week=${d.week}&year=${d.year}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();v.value=s.weekmenus||[]}catch(r){console.error("Failed to load weekmenus:",r)}finally{b.value=!1}};re([()=>d.week,()=>d.year],()=>{O()}),O();const A=()=>{y.order?.id?d.put(`/admin/orders/${y.order.id}`,{preserveScroll:!0,onSuccess:()=>{U("success")}}):d.post("/admin/orders",{preserveScroll:!0,onSuccess:()=>{U("success")}})},_=()=>{k.value=!1,O()};return(r,s)=>(a(),m(T,null,[t("form",{onSubmit:ve(A,["prevent"]),class:"space-y-4"},[t("div",Ye,[t("div",null,[o(e(q),{for:"week"},{default:l(()=>[...s[10]||(s[10]=[g("Week *",-1)])]),_:1}),o(e(I),{id:"week",modelValue:e(d).week,"onUpdate:modelValue":s[0]||(s[0]=w=>e(d).week=w),modelModifiers:{number:!0},type:"number",min:"1",max:"53",disabled:!!u.order,class:D({"border-red-500":e(d).errors.week})},null,8,["modelValue","disabled","class"]),e(d).errors.week?(a(),m("p",He,i(e(d).errors.week),1)):C("",!0)]),t("div",null,[o(e(q),{for:"year"},{default:l(()=>[...s[11]||(s[11]=[g("Year *",-1)])]),_:1}),o(e(I),{id:"year",modelValue:e(d).year,"onUpdate:modelValue":s[1]||(s[1]=w=>e(d).year=w),modelModifiers:{number:!0},type:"number",min:"2020",max:"2100",disabled:!!u.order,class:D({"border-red-500":e(d).errors.year})},null,8,["modelValue","disabled","class"]),e(d).errors.year?(a(),m("p",Ge,i(e(d).errors.year),1)):C("",!0)])]),t("div",null,[o(e(q),null,{default:l(()=>[...s[12]||(s[12]=[g("Client *",-1)])]),_:1}),o(ae,{modelValue:e(d).user_id,"onUpdate:modelValue":s[2]||(s[2]=w=>e(d).user_id=w),error:e(d).errors.user_id,disabled:!!u.order},null,8,["modelValue","error","disabled"])]),t("div",null,[t("div",Qe,[o(e(q),{for:"weekmenu"},{default:l(()=>[...s[13]||(s[13]=[g("Menu *",-1)])]),_:1}),o(e(j),{type:"button",variant:"link",size:"sm",class:"h-auto p-0",onClick:s[3]||(s[3]=w=>k.value=!0)},{default:l(()=>[...s[14]||(s[14]=[g(" + Add Menu to Week ",-1)])]),_:1})]),Q(t("select",{id:"weekmenu","onUpdate:modelValue":s[4]||(s[4]=w=>e(d).weekmenu_id=w),class:D(["h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-red-500":e(d).errors.weekmenu_id}])},[s[15]||(s[15]=t("option",{value:null},"Select a menu",-1)),(a(!0),m(T,null,N(v.value,w=>(a(),m("option",{key:w.id,value:w.id},i(w.menu.label)+" (€"+i(w.menu.price.toFixed(2))+") ",9,Re))),128))],2),[[le,e(d).weekmenu_id]]),e(d).errors.weekmenu_id?(a(),m("p",Xe,i(e(d).errors.weekmenu_id),1)):C("",!0),!b.value&&v.value.length===0?(a(),m("p",Ke," No menus available for this week. Add one using the button above. ")):C("",!0)]),t("div",null,[o(e(q),{for:"quantity"},{default:l(()=>[...s[16]||(s[16]=[g("Quantity *",-1)])]),_:1}),o(e(I),{id:"quantity",modelValue:e(d).quantity,"onUpdate:modelValue":s[5]||(s[5]=w=>e(d).quantity=w),modelModifiers:{number:!0},type:"number",min:"1",class:D({"border-red-500":e(d).errors.quantity})},null,8,["modelValue","class"]),e(d).errors.quantity?(a(),m("p",Ze,i(e(d).errors.quantity),1)):C("",!0)]),t("div",null,[o(e(q),{for:"notes"},{default:l(()=>[...s[17]||(s[17]=[g("Notes",-1)])]),_:1}),o(e(ye),{id:"notes",modelValue:e(d).notes,"onUpdate:modelValue":s[6]||(s[6]=w=>e(d).notes=w),rows:"3",placeholder:"Optional notes..."},null,8,["modelValue"])]),t("div",Je,[o(e(j),{type:"button",variant:"outline",onClick:s[7]||(s[7]=w=>U("cancel"))},{default:l(()=>[...s[18]||(s[18]=[g(" Cancel ",-1)])]),_:1}),o(e(j),{type:"submit",disabled:e(d).processing},{default:l(()=>[g(i(u.order?"Update":"Add")+" Order ",1)]),_:1},8,["disabled"])])],32),o(e(R),{open:k.value,"onUpdate:open":s[9]||(s[9]=w=>k.value=w)},{default:l(()=>[o(e(X),null,{default:l(()=>[o(e(K),null,{default:l(()=>[o(e(Z),null,{default:l(()=>[g("Add Menu to Week "+i(e(d).week)+", "+i(e(d).year),1)]),_:1}),o(e(J),null,{default:l(()=>[...s[19]||(s[19]=[g("Add a menu to this week",-1)])]),_:1})]),_:1}),o(be,{menus:u.menus,groups:u.groups,defaultWeek:e(d).week,defaultYear:e(d).year,submitUrl:"/admin/weekmenus",method:"post",onSuccess:_,onCancel:s[8]||(s[8]=w=>k.value=!1)},null,8,["menus","groups","defaultWeek","defaultYear"])]),_:1})]),_:1},8,["open"])],64))}}),et={class:"flex gap-2 border-b"},tt={key:0,class:"space-y-4 mt-4"},st={class:"space-y-2"},ot={class:"flex items-center space-x-2 cursor-pointer"},rt={class:"text-sm"},lt={class:"flex items-center space-x-2 cursor-pointer"},nt={class:"text-sm"},at={key:1,class:"space-y-4 mt-4"},dt={class:"space-y-2 mt-2"},it=["onClick"],ut={class:"flex justify-between items-center"},ct={class:"font-medium"},mt={class:"text-sm text-muted-foreground"},vt={class:"font-semibold"},ft={key:0,class:"space-y-4 p-4 border rounded-lg bg-gray-50"},pt={key:2,class:"mt-4"},yt=B({__name:"EditOrderDialog",props:{order:{},open:{type:Boolean},menus:{},groups:{}},emits:["update:open","success"],setup(u,{emit:F}){const y=u,U=F,v=S("change-client"),b=G({new_user_id:null,action:"move"}),k=()=>{if(!b.new_user_id){alert("Please select a client");return}const _=y.order.orders[0]?.week,r=y.order.orders[0]?.year;P.post(`/admin/orders/change-client/${y.order.user.id}`,{new_user_id:b.new_user_id,action:b.action,week:_,year:r},{preserveScroll:!0,onSuccess:()=>{U("success")},onError:s=>{console.error("Change client errors:",s)}})},V=S(null),p=G({quantity:1,special_price:""}),d=_=>{V.value=_;const r=y.order.orders.find(s=>s.id===_);r&&(p.quantity=r.quantity,p.special_price=r.special_price??"")},O=()=>{if(!V.value){alert("Please select an order to edit");return}P.put(`/admin/orders/${V.value}`,{quantity:p.quantity,special_price:p.special_price||null},{preserveScroll:!0,onSuccess:()=>{V.value=null,U("success")},onError:_=>{console.error("Update order errors:",_)}})},A=()=>{U("success")};return(_,r)=>(a(),L(e(R),{open:u.open,"onUpdate:open":r[8]||(r[8]=s=>U("update:open",s))},{default:l(()=>[o(e(X),{class:"max-w-2xl max-h-[90vh] overflow-y-auto"},{default:l(()=>[o(e(K),null,{default:l(()=>[o(e(Z),null,{default:l(()=>[g("Edit Orders for "+i(u.order.user.name),1)]),_:1}),o(e(J),null,{default:l(()=>[...r[9]||(r[9]=[g("Manage orders for this client",-1)])]),_:1})]),_:1}),t("div",et,[t("button",{onClick:r[0]||(r[0]=s=>v.value="change-client"),class:D(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",v.value==="change-client"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Change Client ",2),t("button",{onClick:r[1]||(r[1]=s=>v.value="edit-quantities"),class:D(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",v.value==="edit-quantities"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Edit Orders ",2),t("button",{onClick:r[2]||(r[2]=s=>v.value="add-order"),class:D(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",v.value==="add-order"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Add Order ",2)]),v.value==="change-client"?(a(),m("div",tt,[t("div",null,[o(e(q),null,{default:l(()=>[...r[10]||(r[10]=[g("Select New Client",-1)])]),_:1}),o(ae,{modelValue:e(b).new_user_id,"onUpdate:modelValue":r[3]||(r[3]=s=>e(b).new_user_id=s)},null,8,["modelValue"])]),t("div",null,[o(e(q),{class:"mb-2 block"},{default:l(()=>[...r[11]||(r[11]=[g("Action",-1)])]),_:1}),t("div",st,[t("label",ot,[Q(t("input",{type:"radio",value:"move","onUpdate:modelValue":r[4]||(r[4]=s=>e(b).action=s),class:"h-4 w-4 text-primary"},null,512),[[oe,e(b).action]]),t("span",rt,"Move all orders (remove from "+i(u.order.user.name)+")",1)]),t("label",lt,[Q(t("input",{type:"radio",value:"copy","onUpdate:modelValue":r[5]||(r[5]=s=>e(b).action=s),class:"h-4 w-4 text-primary"},null,512),[[oe,e(b).action]]),t("span",nt,"Copy all orders (keep on "+i(u.order.user.name)+")",1)])])]),o(e(j),{onClick:k,disabled:!e(b).new_user_id,class:"w-full"},{default:l(()=>[g(i(e(b).action==="move"?"Move":"Copy")+" Orders ",1)]),_:1},8,["disabled"])])):C("",!0),v.value==="edit-quantities"?(a(),m("div",at,[t("div",null,[o(e(q),null,{default:l(()=>[...r[12]||(r[12]=[g("Select Order to Edit",-1)])]),_:1}),t("div",dt,[(a(!0),m(T,null,N(u.order.orders,s=>(a(),m("button",{key:s.id,type:"button",onClick:w=>d(s.id),class:D(["w-full text-left p-3 rounded border transition-colors",V.value===s.id?"border-primary bg-primary/5":"border-gray-200 hover:border-primary/50"])},[t("div",ut,[t("div",null,[t("div",ct,i(s.quantity)+"× "+i(s.weekmenu.menu.label),1),t("div",mt,i(s.special_price?`€${s.special_price.toFixed(2)}`:`€${s.weekmenu.menu.price.toFixed(2)}`)+" each ",1)]),t("div",vt," €"+i(((s.special_price??s.weekmenu.menu.price)*s.quantity).toFixed(2)),1)])],10,it))),128))])]),V.value?(a(),m("div",ft,[t("div",null,[o(e(q),{for:"quantity"},{default:l(()=>[...r[13]||(r[13]=[g("Quantity",-1)])]),_:1}),o(e(I),{id:"quantity",modelValue:e(p).quantity,"onUpdate:modelValue":r[6]||(r[6]=s=>e(p).quantity=s),modelModifiers:{number:!0},type:"number",min:"1"},null,8,["modelValue"])]),t("div",null,[o(e(q),{for:"special_price"},{default:l(()=>[...r[14]||(r[14]=[g("Special Price (optional)",-1)])]),_:1}),o(e(I),{id:"special_price",modelValue:e(p).special_price,"onUpdate:modelValue":r[7]||(r[7]=s=>e(p).special_price=s),type:"number",step:"0.01",min:"0",placeholder:"Leave empty for default price"},null,8,["modelValue"])]),o(e(j),{onClick:O,class:"w-full"},{default:l(()=>[...r[15]||(r[15]=[g(" Update Order ",-1)])]),_:1})])):C("",!0)])):C("",!0),v.value==="add-order"?(a(),m("div",pt,[o(de,{user_id:u.order.user.id,week:u.order.orders[0]?.week,year:u.order.orders[0]?.year,menus:u.menus,groups:u.groups,onSuccess:A,onCancel:()=>{}},null,8,["user_id","week","year","menus","groups"])])):C("",!0)]),_:1})]),_:1},8,["open"]))}}),xt={class:"grid grid-cols-2 gap-6"},bt={class:"space-y-4"},gt={key:0,class:"text-sm text-red-500 mt-1"},wt={key:0,class:"text-sm text-red-500 mt-1"},kt={class:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-2"},_t=["onClick"],$t={class:"flex-1"},ht={class:"font-medium"},Ct={class:"text-sm text-muted-foreground"},Vt={class:"flex items-center gap-3"},St={class:"font-semibold"},Ut={class:"border-t pt-4 space-y-2"},qt={class:"flex justify-between text-sm"},Ft={class:"flex justify-between text-sm"},Ot={class:"flex justify-between font-bold text-lg border-t pt-2"},Dt={class:"space-y-4"},Mt={key:0,class:"text-center py-8 text-muted-foreground"},Tt={key:1,class:"text-center py-8 text-muted-foreground"},jt={key:2,class:"space-y-2 max-h-[500px] overflow-y-auto"},It=["onClick"],At={class:"flex justify-between items-start"},Et={class:"font-semibold"},Nt={class:"text-sm text-muted-foreground"},Wt={class:"text-xs text-muted-foreground mt-1"},Pt={class:"text-right"},Lt={class:"font-bold"},zt=B({__name:"InvoiceDialog",props:{order:{},open:{type:Boolean}},emits:["update:open","success"],setup(u,{emit:F}){const y=u,U=F,v=S(y.order.orders.map(x=>x.id)),b=S([]),k=S(!1),V=W(()=>{const x=y.order.orders[0]?.year||new Date().getFullYear(),c=y.order.orders[0]?.week||1,$=String(c).padStart(2,"0"),z=String(y.order.user.id).padStart(5,"0");return`${x}${$}${z}`}),p=G({invoice_number:V.value,invoice_date:new Date().toISOString().split("T")[0],user_id:y.order.user.id,order_ids:v.value}),d=W(()=>y.order.orders.filter(x=>v.value.includes(x.id))),O=x=>x.special_price??x.weekmenu.menu.price,A=x=>x.quantity*O(x),_=W(()=>d.value.reduce((x,c)=>x+A(c),0)),r=W(()=>_.value/1.09),s=W(()=>_.value-r.value),w=x=>{const c=v.value.indexOf(x);c>-1?v.value.splice(c,1):v.value.push(x)},M=async()=>{k.value=!0;try{const c=await(await fetch(`/admin/invoices/by-user/${y.order.user.id}`)).json();b.value=c.invoices||[]}catch(x){console.error("Failed to load invoices:",x)}finally{k.value=!1}};M(),re(()=>y.order.user.id,()=>{M(),p.invoice_number=V.value,p.invoice_date=new Date().toISOString().split("T")[0],p.user_id=y.order.user.id,v.value=y.order.orders.map(x=>x.id)});const ee=()=>{if(v.value.length===0){alert("Please select at least one order");return}p.order_ids=v.value,P.post("/admin/invoices",p.data(),{preserveScroll:!0,onSuccess:()=>{M(),p.invoice_number=V.value,p.invoice_date=new Date().toISOString().split("T")[0],v.value=y.order.orders.map(x=>x.id)},onError:x=>{console.error("Invoice creation errors:",x)}})},te=x=>new Date(x).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),se=x=>{window.open(`/admin/invoices/${x}/pdf`,"_blank")};return(x,c)=>(a(),L(e(R),{open:u.open,"onUpdate:open":c[2]||(c[2]=$=>U("update:open",$))},{default:l(()=>[o(e(X),{class:"max-w-6xl max-h-[90vh] overflow-y-auto"},{default:l(()=>[o(e(K),null,{default:l(()=>[o(e(Z),null,{default:l(()=>[g("Generate Invoice for "+i(u.order.user.name),1)]),_:1}),o(e(J),null,{default:l(()=>[...c[3]||(c[3]=[g("Create a new invoice or view existing invoices",-1)])]),_:1})]),_:1}),t("div",xt,[t("div",bt,[c[11]||(c[11]=t("h3",{class:"text-lg font-semibold"},"New Invoice",-1)),t("div",null,[o(e(q),{for:"invoice_number"},{default:l(()=>[...c[4]||(c[4]=[g("Invoice Number *",-1)])]),_:1}),o(e(I),{id:"invoice_number",modelValue:e(p).invoice_number,"onUpdate:modelValue":c[0]||(c[0]=$=>e(p).invoice_number=$),class:D({"border-red-500":e(p).errors.invoice_number})},null,8,["modelValue","class"]),e(p).errors.invoice_number?(a(),m("p",gt,i(e(p).errors.invoice_number),1)):C("",!0)]),t("div",null,[o(e(q),{for:"invoice_date"},{default:l(()=>[...c[5]||(c[5]=[g("Invoice Date *",-1)])]),_:1}),o(e(I),{id:"invoice_date",type:"date",modelValue:e(p).invoice_date,"onUpdate:modelValue":c[1]||(c[1]=$=>e(p).invoice_date=$),class:D({"border-red-500":e(p).errors.invoice_date})},null,8,["modelValue","class"]),e(p).errors.invoice_date?(a(),m("p",wt,i(e(p).errors.invoice_date),1)):C("",!0)]),t("div",null,[o(e(q),{class:"mb-2 block"},{default:l(()=>[...c[6]||(c[6]=[g("Orders (click to remove)",-1)])]),_:1}),t("div",kt,[(a(!0),m(T,null,N(u.order.orders,$=>(a(),m("button",{key:$.id,type:"button",onClick:z=>w($.id),class:D(["w-full text-left p-3 rounded border transition-colors flex items-center justify-between",v.value.includes($.id)?"border-primary bg-primary/5":"border-gray-300 bg-gray-100 opacity-50"])},[t("div",$t,[t("div",ht,i($.quantity)+"× "+i($.weekmenu.menu.label),1),t("div",Ct," €"+i(O($).toFixed(2))+" each ",1)]),t("div",Vt,[t("span",St,"€"+i(A($).toFixed(2)),1),v.value.includes($.id)?(a(),L(e(ge),{key:0,class:"h-4 w-4 text-red-500"})):C("",!0)])],10,_t))),128))])]),t("div",Ut,[t("div",qt,[c[7]||(c[7]=t("span",null,"Total Excl. VAT",-1)),t("span",null,"€"+i(r.value.toFixed(2)),1)]),t("div",Ft,[c[8]||(c[8]=t("span",null,"VAT (9%)",-1)),t("span",null,"€"+i(s.value.toFixed(2)),1)]),t("div",Ot,[c[9]||(c[9]=t("span",null,"Total Incl. VAT",-1)),t("span",null,"€"+i(_.value.toFixed(2)),1)])]),o(e(j),{onClick:ee,disabled:v.value.length===0||e(p).processing,class:"w-full"},{default:l(()=>[...c[10]||(c[10]=[g(" Generate Invoice ",-1)])]),_:1},8,["disabled"])]),t("div",Dt,[c[13]||(c[13]=t("h3",{class:"text-lg font-semibold"},"Existing Invoices",-1)),k.value?(a(),m("div",Mt," Loading invoices... ")):b.value.length===0?(a(),m("div",Tt," No invoices found for this client ")):(a(),m("div",jt,[(a(!0),m(T,null,N(b.value,$=>(a(),m("button",{key:$.id,type:"button",onClick:z=>se($.id),class:"w-full text-left p-4 rounded border hover:border-primary hover:bg-primary/5 transition-colors"},[t("div",At,[t("div",null,[t("div",Et,i($.invoice_number),1),t("div",Nt,i(te($.invoice_date)),1),t("div",Wt,i($.items_count)+" item(s) ",1)]),t("div",Pt,[t("div",Lt,"€"+i($.total.toFixed(2)),1),c[12]||(c[12]=t("div",{class:"text-xs text-primary mt-1"},"View PDF →",-1))])])],8,It))),128))]))])])]),_:1})]),_:1},8,["open"]))}}),Bt={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},Yt={class:"flex items-center justify-between"},Ht={class:"flex gap-2"},Gt={class:"flex items-center justify-between"},Qt={class:"flex flex-wrap items-center gap-4"},Rt={class:"flex items-center gap-2"},Xt={class:"flex items-center gap-2"},Kt={class:"flex items-center gap-2"},Zt=["value"],Jt={class:"relative flex-1 max-w-sm"},es={key:0,class:"flex justify-end"},ts={class:"text-right"},ss={class:"text-2xl font-bold"},os={key:0,class:"text-center py-12 text-muted-foreground"},rs={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 print-cards"},ls={class:"flex items-start justify-between"},ns={class:"flex-1"},as={class:"space-y-1"},ds={class:"text-xs"},is={class:"flex gap-1 no-print"},us={class:"space-y-3"},cs={key:0,class:"text-sm"},ms={class:"flex-1"},vs={class:"font-medium"},fs={class:"ml-2"},ps={class:"text-right"},ys={class:"flex justify-between font-bold"},Es=B({__name:"Index",props:{groupedOrders:{default:()=>[]},groups:{default:()=>[]},menus:{default:()=>[]},currentWeek:{default:1},currentYear:{default:2025},filters:{default:()=>({search:"",group_id:""})}},setup(u){const F=u,y=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Orders",href:"/admin/orders"}],U=S(F.currentWeek),v=S(F.currentYear),b=S(F.filters?.group_id||""),k=S(F.filters?.search||"");let V;const p=()=>{P.get("/admin/orders",{week:U.value,year:v.value,group_id:b.value,search:k.value})},d=()=>{p()},O=()=>{p()},A=()=>{clearTimeout(V),V=setTimeout(()=>{p()},300)},_=h=>new Date(h).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),r=h=>h.special_price??h.weekmenu.menu.price,s=h=>h.quantity*r(h),w=h=>{const n=h.map(f=>f.notes).filter(f=>f!==null&&f!=="");return[...new Set(n)]},M=S(!1),ee=()=>{M.value=!1,P.reload()},te=()=>{const h=new URLSearchParams({week:String(U.value),year:String(v.value)});b.value&&h.append("group_id",b.value),k.value&&h.append("search",k.value),window.open(`/admin/orders/pdf?${h.toString()}`,"_blank")},se=()=>{const h=new URLSearchParams({week:String(U.value),year:String(v.value)});b.value&&h.append("group_id",b.value),k.value&&h.append("search",k.value),window.location.href=`/admin/orders/export?${h.toString()}`},x=S(null),c=S(!1),$=h=>{x.value=h,c.value=!0},z=()=>{c.value=!1,x.value=null,P.reload()},Y=S(null),H=S(!1),ie=h=>{Y.value=h,H.value=!0},ue=()=>{H.value=!1,Y.value=null,P.reload()};return(h,n)=>(a(),m(T,null,[o(e(fe),{title:"Orders"}),o(pe,{breadcrumbs:y},{default:l(()=>[t("div",Bt,[t("div",Yt,[n[12]||(n[12]=t("h2",{class:"text-2xl font-bold"},"Orders",-1)),t("div",Ht,[o(e(j),{onClick:n[0]||(n[0]=f=>M.value=!0)},{default:l(()=>[...n[9]||(n[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),g(" Add Order ",-1)])]),_:1}),o(e(j),{variant:"outline",onClick:te},{default:l(()=>[...n[10]||(n[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1),g(" Print ",-1)])]),_:1}),o(e(j),{variant:"outline",onClick:se},{default:l(()=>[...n[11]||(n[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),g(" Export Excel ",-1)])]),_:1})])]),t("div",Gt,[t("div",Qt,[t("div",Rt,[n[13]||(n[13]=t("label",{for:"week",class:"text-sm font-medium"},"Week:",-1)),o(e(I),{id:"week",modelValue:U.value,"onUpdate:modelValue":n[1]||(n[1]=f=>U.value=f),modelModifiers:{number:!0},type:"number",min:"1",max:"53",class:"w-20",onChange:d},null,8,["modelValue"])]),t("div",Xt,[n[14]||(n[14]=t("label",{for:"year",class:"text-sm font-medium"},"Year:",-1)),o(e(I),{id:"year",modelValue:v.value,"onUpdate:modelValue":n[2]||(n[2]=f=>v.value=f),modelModifiers:{number:!0},type:"number",min:"2020",max:"2100",class:"w-24",onChange:d},null,8,["modelValue"])]),t("div",Kt,[n[16]||(n[16]=t("label",{for:"group-filter",class:"text-sm font-medium"},"Group:",-1)),Q(t("select",{id:"group-filter","onUpdate:modelValue":n[3]||(n[3]=f=>b.value=f),onChange:O,class:"h-10 w-[200px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[n[15]||(n[15]=t("option",{value:""},"All Groups",-1)),(a(!0),m(T,null,N(u.groups,f=>(a(),m("option",{key:f.id,value:String(f.id)},i(f.name),9,Zt))),128))],544),[[le,b.value]])]),t("div",Jt,[o(e(Ce),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),o(e(I),{modelValue:k.value,"onUpdate:modelValue":n[4]||(n[4]=f=>k.value=f),onInput:A,type:"search",placeholder:"Search by client or menu name...",class:"pl-9"},null,8,["modelValue"])])]),u.groupedOrders.length>0?(a(),m("div",es,[t("div",ts,[n[17]||(n[17]=t("div",{class:"text-sm text-muted-foreground"},"Total Orders",-1)),t("div",ss," €"+i(u.groupedOrders.reduce((f,E)=>f+E.total,0).toFixed(2)),1)])])):C("",!0)]),u.groupedOrders.length===0?(a(),m("div",os," No orders found for the selected filters. ")):C("",!0),t("div",rs,[(a(!0),m(T,null,N(u.groupedOrders,f=>(a(),L(e(we),{key:f.user.id},{default:l(()=>[o(e($e),null,{default:l(()=>[t("div",ls,[t("div",ns,[o(e(he),null,{default:l(()=>[g(i(f.user.name),1)]),_:2},1024),o(e(_e),null,{default:l(()=>[t("div",as,[t("div",null,"Group: "+i(f.group?.name??"No Group"),1),t("div",ds,i(_(f.order_date)),1)])]),_:2},1024)]),t("div",is,[o(e(j),{size:"sm",variant:"ghost",onClick:E=>$(f)},{default:l(()=>[o(e(Se),{class:"h-4 w-4"})]),_:1},8,["onClick"]),o(e(j),{size:"sm",variant:"ghost",onClick:E=>ie(f)},{default:l(()=>[o(e(Ve),{class:"h-4 w-4"})]),_:1},8,["onClick"])])])]),_:2},1024),o(e(ke),null,{default:l(()=>[t("div",us,[w(f.orders).length>0?(a(),m("div",cs,[n[18]||(n[18]=t("div",{class:"font-medium mb-1"},"Notes:",-1)),(a(!0),m(T,null,N(w(f.orders),(E,ce)=>(a(),m("div",{key:ce,class:"text-muted-foreground"}," • "+i(E),1))),128)),n[19]||(n[19]=t("div",{class:"border-t mt-3 mb-3"},null,-1))])):C("",!0),(a(!0),m(T,null,N(f.orders,E=>(a(),m("div",{key:E.id,class:"flex justify-between text-sm"},[t("div",ms,[t("span",vs,i(E.quantity)+"×",1),t("span",fs,i(E.weekmenu.menu.label),1)]),t("div",ps," €"+i(s(E).toFixed(2)),1)]))),128)),n[21]||(n[21]=t("div",{class:"border-t"},null,-1)),t("div",ys,[n[20]||(n[20]=t("span",null,"Total",-1)),t("span",null,"€"+i(f.total.toFixed(2)),1)])])]),_:2},1024)]),_:2},1024))),128))])])]),_:1}),o(e(R),{open:M.value,"onUpdate:open":n[6]||(n[6]=f=>M.value=f)},{default:l(()=>[o(e(X),{class:"max-w-md"},{default:l(()=>[o(e(K),null,{default:l(()=>[o(e(Z),null,{default:l(()=>[...n[22]||(n[22]=[g("Add Order",-1)])]),_:1}),o(e(J),null,{default:l(()=>[...n[23]||(n[23]=[g("Create a new order for a client",-1)])]),_:1})]),_:1}),o(de,{week:u.currentWeek,year:u.currentYear,menus:u.menus,groups:u.groups,onSuccess:ee,onCancel:n[5]||(n[5]=f=>M.value=!1)},null,8,["week","year","menus","groups"])]),_:1})]),_:1},8,["open"]),x.value?(a(),L(yt,{key:0,order:x.value,open:c.value,menus:u.menus,groups:u.groups,"onUpdate:open":n[7]||(n[7]=f=>c.value=f),onSuccess:z},null,8,["order","open","menus","groups"])):C("",!0),Y.value?(a(),L(zt,{key:1,order:Y.value,open:H.value,"onUpdate:open":n[8]||(n[8]=f=>H.value=f),onSuccess:ue},null,8,["order","open"])):C("",!0)],64))}});export{Es as default};
