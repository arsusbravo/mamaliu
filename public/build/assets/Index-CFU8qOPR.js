import{d as Q,j as S,k as z,m as be,c as a,b as e,f as U,y as D,t as u,a as l,u as t,F as O,r as q,e as Y,o as r,q as ee,B as K,s as ge,w as m,g as $,z as A,C as W,D as ne,i as H,h as ye,E as xe}from"./app-BUDQIbDx.js";import{_ as we}from"./AppLayout.vue_vue_type_script_setup_true_lang-BMvVxeiX.js";import{a as P,_ as M}from"./Label.vue_vue_type_script_setup_true_lang-CtSbfQFT.js";import{c as ae,_ as N}from"./index-FtfLgv6C.js";import{_ as te,a as se,b as oe,c as le,d as re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-JBNys0q8.js";import{_ as ke}from"./Textarea.vue_vue_type_script_setup_true_lang-CGSIXhOn.js";import{C as _e}from"./check-O_BZIMDr.js";import{_ as he,F as $e}from"./MenuSelector.vue_vue_type_script_setup_true_lang-BGrkvAHv.js";import{X as Ce}from"./x-D_WQvu5R.js";import{_ as Ve,a as Se}from"./CardContent.vue_vue_type_script_setup_true_lang-BYAdqoSA.js";import{_ as Ue}from"./CardDescription.vue_vue_type_script_setup_true_lang-DCbNPxZH.js";import{_ as Fe,a as Oe}from"./CardTitle.vue_vue_type_script_setup_true_lang-CwAGmQ3G.js";import{S as ie}from"./search-C5K1aHO-.js";import"./index-B8We5vQ-.js";import"./shopping-bag-CiHdv9nk.js";import"./image-off-DkU_9akq.js";const qe=ae("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const De=ae("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Me={class:"grid gap-2"},Te=["disabled"],je={key:0,class:"flex flex-col"},Ie={class:"font-medium"},Ee={class:"text-xs text-muted-foreground"},Ne={key:1,class:"text-muted-foreground"},Ae={key:0,class:"relative"},ze={class:"absolute z-50 w-full mt-1 bg-background border rounded-md shadow-lg"},Pe={class:"p-2 border-b"},Le={class:"max-h-64 overflow-y-auto"},Ye={class:"p-1"},Be=["onClick"],We={class:"flex flex-col text-left"},He={class:"font-medium"},Ge={class:"text-xs text-muted-foreground"},Qe={key:0,class:"p-4 text-center text-muted-foreground"},Re={key:1,class:"text-sm text-red-500"},de=Q({__name:"ClientSelector",props:{modelValue:{default:null},error:{default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(c,{emit:j}){const g=c,F=j,f=S(""),y=S(!1),w=S([]),V=z(()=>!g.modelValue||!w.value?null:w.value.find(k=>k.id===g.modelValue)),b=z(()=>{if(!f.value)return w.value;const k=f.value.toLowerCase();return w.value.filter(n=>n.name.toLowerCase().includes(k)||n.email.toLowerCase().includes(k))}),E=async()=>{try{const n=await(await fetch("/admin/clients/list")).json();w.value=n.clients||[]}catch(k){console.error("Failed to load clients:",k)}},v=k=>{F("update:modelValue",k),y.value=!1,f.value=""},T=()=>{g.disabled||(y.value=!y.value,y.value&&w.value.length===0&&E())};return be(()=>{g.modelValue&&E()}),(k,n)=>(r(),a("div",Me,[e("button",{type:"button",onClick:T,disabled:c.disabled,class:D(["flex items-center justify-between gap-3 w-full px-3 py-2 text-left border rounded-md bg-background hover:bg-accent",c.error?"border-red-500":"border-input",c.disabled?"opacity-50 cursor-not-allowed":""])},[V.value?(r(),a("div",je,[e("span",Ie,u(V.value.name),1),e("span",Ee,u(V.value.email),1)])):(r(),a("span",Ne,"Select a client")),n[1]||(n[1]=e("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))],10,Te),y.value?(r(),a("div",Ae,[e("div",ze,[e("div",Pe,[l(t(P),{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=i=>f.value=i),type:"text",placeholder:"Search by name or email...",class:"w-full"},null,8,["modelValue"])]),e("div",Le,[e("div",Ye,[(r(!0),a(O,null,q(b.value,i=>(r(),a("button",{key:i.id,type:"button",onClick:d=>v(i.id),class:"flex items-center justify-between w-full px-3 py-2 rounded hover:bg-accent transition-colors"},[e("div",We,[e("span",He,u(i.name),1),e("span",Ge,u(i.email),1)]),i.id===c.modelValue?(r(),Y(t(_e),{key:0,class:"w-4 h-4 text-primary shrink-0"})):U("",!0)],8,Be))),128)),b.value.length===0?(r(),a("div",Qe," No clients found ")):U("",!0)])])])])):U("",!0),c.error?(r(),a("span",Re,u(c.error),1)):U("",!0)]))}}),Xe={class:"grid grid-cols-2 gap-4"},Ze={key:0,class:"text-sm text-red-500 mt-1"},Je={key:0,class:"text-sm text-red-500 mt-1"},Ke={class:"flex items-center justify-between mb-2"},et={class:"flex gap-1 text-sm"},tt=["value"],st={key:0,class:"text-sm text-muted-foreground mt-1"},ot={key:2,class:"text-sm text-red-500 mt-1"},lt={key:0,class:"text-sm text-red-500 mt-1"},rt={class:"flex justify-end gap-2"},ue=Q({__name:"FormOrder",props:{order:{default:null},user_id:{default:null},week:{},year:{},menus:{},groups:{}},emits:["success","cancel"],setup(c,{emit:j}){const g=c,F=j,f=S([]),y=S(!1),w=S("week"),V=S(""),b=new Date,E=i=>{const d=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),_=d.getUTCDay()||7;d.setUTCDate(d.getUTCDate()+4-_);const G=new Date(Date.UTC(d.getUTCFullYear(),0,1));return Math.ceil(((d.getTime()-G.getTime())/864e5+1)/7)},v=ee({user_id:g.order?.user_id||g.user_id||null,weekmenu_id:g.order?.weekmenu_id||null,menu_id:null,quantity:g.order?.quantity||1,notes:g.order?.notes||"",week:g.order?.week||g.week||E(b),year:g.order?.year||g.year||b.getFullYear()}),T=async()=>{try{y.value=!0;const d=await(await fetch(`/admin/weekmenus/list?week=${v.week}&year=${v.year}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();f.value=d.weekmenus||[]}catch(i){console.error("Failed to load weekmenus:",i)}finally{y.value=!1}};K([()=>v.week,()=>v.year],()=>{T()}),K(w,()=>{v.weekmenu_id=null,v.menu_id=null,V.value=""}),K(V,i=>{v.menu_id=i?Number(i):null}),T();const k=()=>{g.order?.id?v.put(`/admin/orders/${g.order.id}`,{preserveScroll:!0,onSuccess:()=>{F("success")}}):v.post("/admin/orders",{preserveScroll:!0,onSuccess:()=>{F("success")}})},n=z(()=>v.errors.weekmenu_id||v.errors.menu_id);return(i,d)=>(r(),a("form",{onSubmit:ge(k,["prevent"]),class:"space-y-4"},[e("div",Xe,[e("div",null,[l(t(M),{for:"week"},{default:m(()=>[...d[10]||(d[10]=[$("Week *",-1)])]),_:1}),l(t(P),{id:"week",modelValue:t(v).week,"onUpdate:modelValue":d[0]||(d[0]=_=>t(v).week=_),modelModifiers:{number:!0},type:"number",min:"1",max:"53",disabled:!!c.order,class:D({"border-red-500":t(v).errors.week})},null,8,["modelValue","disabled","class"]),t(v).errors.week?(r(),a("p",Ze,u(t(v).errors.week),1)):U("",!0)]),e("div",null,[l(t(M),{for:"year"},{default:m(()=>[...d[11]||(d[11]=[$("Year *",-1)])]),_:1}),l(t(P),{id:"year",modelValue:t(v).year,"onUpdate:modelValue":d[1]||(d[1]=_=>t(v).year=_),modelModifiers:{number:!0},type:"number",min:"2020",max:"2100",disabled:!!c.order,class:D({"border-red-500":t(v).errors.year})},null,8,["modelValue","disabled","class"]),t(v).errors.year?(r(),a("p",Je,u(t(v).errors.year),1)):U("",!0)])]),e("div",null,[l(t(M),null,{default:m(()=>[...d[12]||(d[12]=[$("Client *",-1)])]),_:1}),l(de,{modelValue:t(v).user_id,"onUpdate:modelValue":d[2]||(d[2]=_=>t(v).user_id=_),error:t(v).errors.user_id,disabled:!!c.order},null,8,["modelValue","error","disabled"])]),e("div",null,[e("div",Ke,[l(t(M),null,{default:m(()=>[...d[13]||(d[13]=[$("Menu *",-1)])]),_:1}),e("div",et,[e("button",{type:"button",onClick:d[3]||(d[3]=_=>w.value="week"),class:D(["px-2 py-1 rounded transition-colors",w.value==="week"?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"])}," Week Menus ",2),e("button",{type:"button",onClick:d[4]||(d[4]=_=>w.value="all"),class:D(["px-2 py-1 rounded transition-colors",w.value==="all"?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"])}," All Menus ",2)])]),w.value==="week"?(r(),a(O,{key:0},[A(e("select",{id:"weekmenu","onUpdate:modelValue":d[5]||(d[5]=_=>t(v).weekmenu_id=_),class:D(["h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-red-500":n.value}])},[d[14]||(d[14]=e("option",{value:null},"Select a menu",-1)),(r(!0),a(O,null,q(f.value,_=>(r(),a("option",{key:_.id,value:_.id},u(_.menu.label)+" (€"+u(_.menu.price.toFixed(2))+") ",9,tt))),128))],2),[[W,t(v).weekmenu_id]]),!y.value&&f.value.length===0?(r(),a("p",st,' No menus for this week. Switch to "All Menus" to select any menu. ')):U("",!0)],64)):(r(),Y(he,{key:1,menus:c.menus,modelValue:V.value,"onUpdate:modelValue":d[6]||(d[6]=_=>V.value=_),error:n.value},null,8,["menus","modelValue","error"])),n.value?(r(),a("p",ot,u(n.value),1)):U("",!0)]),e("div",null,[l(t(M),{for:"quantity"},{default:m(()=>[...d[15]||(d[15]=[$("Quantity *",-1)])]),_:1}),l(t(P),{id:"quantity",modelValue:t(v).quantity,"onUpdate:modelValue":d[7]||(d[7]=_=>t(v).quantity=_),modelModifiers:{number:!0},type:"number",min:"1",class:D({"border-red-500":t(v).errors.quantity})},null,8,["modelValue","class"]),t(v).errors.quantity?(r(),a("p",lt,u(t(v).errors.quantity),1)):U("",!0)]),e("div",null,[l(t(M),{for:"notes"},{default:m(()=>[...d[16]||(d[16]=[$("Notes",-1)])]),_:1}),l(t(ke),{id:"notes",modelValue:t(v).notes,"onUpdate:modelValue":d[8]||(d[8]=_=>t(v).notes=_),rows:"3",placeholder:"Optional notes..."},null,8,["modelValue"])]),e("div",rt,[l(t(N),{type:"button",variant:"outline",onClick:d[9]||(d[9]=_=>F("cancel"))},{default:m(()=>[...d[17]||(d[17]=[$(" Cancel ",-1)])]),_:1}),l(t(N),{type:"submit",disabled:t(v).processing},{default:m(()=>[$(u(c.order?"Update":"Add")+" Order ",1)]),_:1},8,["disabled"])])],32))}}),nt={class:"flex gap-2 border-b"},it={key:0,class:"space-y-4 mt-4"},at={class:"space-y-2"},dt={class:"flex items-center space-x-2 cursor-pointer"},ut={class:"text-sm"},ct={class:"flex items-center space-x-2 cursor-pointer"},mt={class:"text-sm"},vt={key:1,class:"space-y-4 mt-4"},ft={class:"space-y-2 mt-2"},pt=["onClick"],bt={class:"flex justify-between items-center"},gt={class:"font-medium"},yt={class:"text-sm text-muted-foreground"},xt={class:"font-semibold"},wt={key:0,class:"space-y-4 p-4 border rounded-lg bg-gray-50"},kt={key:2,class:"mt-4"},_t=Q({__name:"EditOrderDialog",props:{order:{},open:{type:Boolean},menus:{},groups:{}},emits:["update:open","success"],setup(c,{emit:j}){const g=c,F=j,f=S("change-client"),y=ee({new_user_id:null,action:"move"}),w=()=>{if(!y.new_user_id){alert("Please select a client");return}const k=g.order.orders[0]?.week,n=g.order.orders[0]?.year;H.post(`/admin/orders/change-client/${g.order.user.id}`,{new_user_id:y.new_user_id,action:y.action,week:k,year:n},{preserveScroll:!0,onSuccess:()=>{F("success")},onError:i=>{console.error("Change client errors:",i)}})},V=S(null),b=ee({quantity:1,special_price:""}),E=k=>{V.value=k;const n=g.order.orders.find(i=>i.id===k);n&&(b.quantity=n.quantity,b.special_price=n.special_price??"")},v=()=>{if(!V.value){alert("Please select an order to edit");return}H.put(`/admin/orders/${V.value}`,{quantity:b.quantity,special_price:b.special_price||null},{preserveScroll:!0,onSuccess:()=>{V.value=null,F("success")},onError:k=>{console.error("Update order errors:",k)}})},T=()=>{F("success")};return(k,n)=>(r(),Y(t(te),{open:c.open,"onUpdate:open":n[8]||(n[8]=i=>F("update:open",i))},{default:m(()=>[l(t(se),{class:"max-w-2xl max-h-[90vh] overflow-y-auto"},{default:m(()=>[l(t(oe),null,{default:m(()=>[l(t(le),null,{default:m(()=>[$("Edit Orders for "+u(c.order.user.name),1)]),_:1}),l(t(re),null,{default:m(()=>[...n[9]||(n[9]=[$("Manage orders for this client",-1)])]),_:1})]),_:1}),e("div",nt,[e("button",{onClick:n[0]||(n[0]=i=>f.value="change-client"),class:D(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",f.value==="change-client"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Change Client ",2),e("button",{onClick:n[1]||(n[1]=i=>f.value="edit-quantities"),class:D(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",f.value==="edit-quantities"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Edit Orders ",2),e("button",{onClick:n[2]||(n[2]=i=>f.value="add-order"),class:D(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",f.value==="add-order"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Add Order ",2)]),f.value==="change-client"?(r(),a("div",it,[e("div",null,[l(t(M),null,{default:m(()=>[...n[10]||(n[10]=[$("Select New Client",-1)])]),_:1}),l(de,{modelValue:t(y).new_user_id,"onUpdate:modelValue":n[3]||(n[3]=i=>t(y).new_user_id=i)},null,8,["modelValue"])]),e("div",null,[l(t(M),{class:"mb-2 block"},{default:m(()=>[...n[11]||(n[11]=[$("Action",-1)])]),_:1}),e("div",at,[e("label",dt,[A(e("input",{type:"radio",value:"move","onUpdate:modelValue":n[4]||(n[4]=i=>t(y).action=i),class:"h-4 w-4 text-primary"},null,512),[[ne,t(y).action]]),e("span",ut,"Move all orders (remove from "+u(c.order.user.name)+")",1)]),e("label",ct,[A(e("input",{type:"radio",value:"copy","onUpdate:modelValue":n[5]||(n[5]=i=>t(y).action=i),class:"h-4 w-4 text-primary"},null,512),[[ne,t(y).action]]),e("span",mt,"Copy all orders (keep on "+u(c.order.user.name)+")",1)])])]),l(t(N),{onClick:w,disabled:!t(y).new_user_id,class:"w-full"},{default:m(()=>[$(u(t(y).action==="move"?"Move":"Copy")+" Orders ",1)]),_:1},8,["disabled"])])):U("",!0),f.value==="edit-quantities"?(r(),a("div",vt,[e("div",null,[l(t(M),null,{default:m(()=>[...n[12]||(n[12]=[$("Select Order to Edit",-1)])]),_:1}),e("div",ft,[(r(!0),a(O,null,q(c.order.orders,i=>(r(),a("button",{key:i.id,type:"button",onClick:d=>E(i.id),class:D(["w-full text-left p-3 rounded border transition-colors",V.value===i.id?"border-primary bg-primary/5":"border-gray-200 hover:border-primary/50"])},[e("div",bt,[e("div",null,[e("div",gt,u(i.quantity)+"× "+u(i.weekmenu.menu.label),1),e("div",yt,u(i.special_price?`€${i.special_price.toFixed(2)}`:`€${i.weekmenu.menu.price.toFixed(2)}`)+" each ",1)]),e("div",xt," €"+u(((i.special_price??i.weekmenu.menu.price)*i.quantity).toFixed(2)),1)])],10,pt))),128))])]),V.value?(r(),a("div",wt,[e("div",null,[l(t(M),{for:"quantity"},{default:m(()=>[...n[13]||(n[13]=[$("Quantity",-1)])]),_:1}),l(t(P),{id:"quantity",modelValue:t(b).quantity,"onUpdate:modelValue":n[6]||(n[6]=i=>t(b).quantity=i),modelModifiers:{number:!0},type:"number",min:"1"},null,8,["modelValue"])]),e("div",null,[l(t(M),{for:"special_price"},{default:m(()=>[...n[14]||(n[14]=[$("Special Price (optional)",-1)])]),_:1}),l(t(P),{id:"special_price",modelValue:t(b).special_price,"onUpdate:modelValue":n[7]||(n[7]=i=>t(b).special_price=i),type:"number",step:"0.01",min:"0",placeholder:"Leave empty for default price"},null,8,["modelValue"])]),l(t(N),{onClick:v,class:"w-full"},{default:m(()=>[...n[15]||(n[15]=[$(" Update Order ",-1)])]),_:1})])):U("",!0)])):U("",!0),f.value==="add-order"?(r(),a("div",kt,[l(ue,{user_id:c.order.user.id,week:c.order.orders[0]?.week,year:c.order.orders[0]?.year,menus:c.menus,groups:c.groups,onSuccess:T,onCancel:()=>{}},null,8,["user_id","week","year","menus","groups"])])):U("",!0)]),_:1})]),_:1},8,["open"]))}}),ht={class:"grid grid-cols-2 gap-6"},$t={class:"space-y-4"},Ct={key:0,class:"text-sm text-red-500 mt-1"},Vt={key:0,class:"text-sm text-red-500 mt-1"},St={class:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-2"},Ut=["onClick"],Ft={class:"flex-1"},Ot={class:"font-medium"},qt={class:"text-sm text-muted-foreground"},Dt={class:"flex items-center gap-3"},Mt={class:"font-semibold"},Tt={class:"border-t pt-4 space-y-2"},jt={class:"flex justify-between text-sm"},It={class:"flex justify-between text-sm"},Et={class:"flex justify-between font-bold text-lg border-t pt-2"},Nt={class:"space-y-4"},At={key:0,class:"text-center py-8 text-muted-foreground"},zt={key:1,class:"text-center py-8 text-muted-foreground"},Pt={key:2,class:"space-y-2 max-h-[500px] overflow-y-auto"},Lt=["onClick"],Yt={class:"flex justify-between items-start"},Bt={class:"font-semibold"},Wt={class:"text-sm text-muted-foreground"},Ht={class:"text-xs text-muted-foreground mt-1"},Gt={class:"text-right"},Qt={class:"font-bold"},Rt=Q({__name:"InvoiceDialog",props:{order:{},open:{type:Boolean}},emits:["update:open","success"],setup(c,{emit:j}){const g=c,F=j,f=S(g.order.orders.map(x=>x.id)),y=S([]),w=S(!1),V=z(()=>{const x=g.order.orders[0]?.year||new Date().getFullYear(),p=g.order.orders[0]?.week||1,C=String(p).padStart(2,"0"),L=String(g.order.user.id).padStart(5,"0");return`${x}${C}${L}`}),b=ee({invoice_number:V.value,invoice_date:new Date().toISOString().split("T")[0],user_id:g.order.user.id,order_ids:f.value}),E=z(()=>g.order.orders.filter(x=>f.value.includes(x.id))),v=x=>x.special_price??x.weekmenu.menu.price,T=x=>x.quantity*v(x),k=z(()=>E.value.reduce((x,p)=>x+T(p),0)),n=z(()=>k.value/1.09),i=z(()=>k.value-n.value),d=x=>{const p=f.value.indexOf(x);p>-1?f.value.splice(p,1):f.value.push(x)},_=async()=>{w.value=!0;try{const p=await(await fetch(`/admin/invoices/by-user/${g.order.user.id}`)).json();y.value=p.invoices||[]}catch(x){console.error("Failed to load invoices:",x)}finally{w.value=!1}};_(),K(()=>g.order.user.id,()=>{_(),b.invoice_number=V.value,b.invoice_date=new Date().toISOString().split("T")[0],b.user_id=g.order.user.id,f.value=g.order.orders.map(x=>x.id)});const G=()=>{if(f.value.length===0){alert("Please select at least one order");return}b.order_ids=f.value,H.post("/admin/invoices",b.data(),{preserveScroll:!0,onSuccess:()=>{_(),b.invoice_number=V.value,b.invoice_date=new Date().toISOString().split("T")[0],f.value=g.order.orders.map(x=>x.id)},onError:x=>{console.error("Invoice creation errors:",x)}})},R=x=>new Date(x).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),B=x=>{window.open(`/admin/invoices/${x}/pdf`,"_blank")};return(x,p)=>(r(),Y(t(te),{open:c.open,"onUpdate:open":p[2]||(p[2]=C=>F("update:open",C))},{default:m(()=>[l(t(se),{class:"max-w-6xl max-h-[90vh] overflow-y-auto"},{default:m(()=>[l(t(oe),null,{default:m(()=>[l(t(le),null,{default:m(()=>[$("Generate Invoice for "+u(c.order.user.name),1)]),_:1}),l(t(re),null,{default:m(()=>[...p[3]||(p[3]=[$("Create a new invoice or view existing invoices",-1)])]),_:1})]),_:1}),e("div",ht,[e("div",$t,[p[11]||(p[11]=e("h3",{class:"text-lg font-semibold"},"New Invoice",-1)),e("div",null,[l(t(M),{for:"invoice_number"},{default:m(()=>[...p[4]||(p[4]=[$("Invoice Number *",-1)])]),_:1}),l(t(P),{id:"invoice_number",modelValue:t(b).invoice_number,"onUpdate:modelValue":p[0]||(p[0]=C=>t(b).invoice_number=C),class:D({"border-red-500":t(b).errors.invoice_number})},null,8,["modelValue","class"]),t(b).errors.invoice_number?(r(),a("p",Ct,u(t(b).errors.invoice_number),1)):U("",!0)]),e("div",null,[l(t(M),{for:"invoice_date"},{default:m(()=>[...p[5]||(p[5]=[$("Invoice Date *",-1)])]),_:1}),l(t(P),{id:"invoice_date",type:"date",modelValue:t(b).invoice_date,"onUpdate:modelValue":p[1]||(p[1]=C=>t(b).invoice_date=C),class:D({"border-red-500":t(b).errors.invoice_date})},null,8,["modelValue","class"]),t(b).errors.invoice_date?(r(),a("p",Vt,u(t(b).errors.invoice_date),1)):U("",!0)]),e("div",null,[l(t(M),{class:"mb-2 block"},{default:m(()=>[...p[6]||(p[6]=[$("Orders (click to remove)",-1)])]),_:1}),e("div",St,[(r(!0),a(O,null,q(c.order.orders,C=>(r(),a("button",{key:C.id,type:"button",onClick:L=>d(C.id),class:D(["w-full text-left p-3 rounded border transition-colors flex items-center justify-between",f.value.includes(C.id)?"border-primary bg-primary/5":"border-gray-300 bg-gray-100 opacity-50"])},[e("div",Ft,[e("div",Ot,u(C.quantity)+"× "+u(C.weekmenu.menu.label),1),e("div",qt," €"+u(v(C).toFixed(2))+" each ",1)]),e("div",Dt,[e("span",Mt,"€"+u(T(C).toFixed(2)),1),f.value.includes(C.id)?(r(),Y(t(Ce),{key:0,class:"h-4 w-4 text-red-500"})):U("",!0)])],10,Ut))),128))])]),e("div",Tt,[e("div",jt,[p[7]||(p[7]=e("span",null,"Total Excl. VAT",-1)),e("span",null,"€"+u(n.value.toFixed(2)),1)]),e("div",It,[p[8]||(p[8]=e("span",null,"VAT (9%)",-1)),e("span",null,"€"+u(i.value.toFixed(2)),1)]),e("div",Et,[p[9]||(p[9]=e("span",null,"Total Incl. VAT",-1)),e("span",null,"€"+u(k.value.toFixed(2)),1)])]),l(t(N),{onClick:G,disabled:f.value.length===0||t(b).processing,class:"w-full"},{default:m(()=>[...p[10]||(p[10]=[$(" Generate Invoice ",-1)])]),_:1},8,["disabled"])]),e("div",Nt,[p[13]||(p[13]=e("h3",{class:"text-lg font-semibold"},"Existing Invoices",-1)),w.value?(r(),a("div",At," Loading invoices... ")):y.value.length===0?(r(),a("div",zt," No invoices found for this client ")):(r(),a("div",Pt,[(r(!0),a(O,null,q(y.value,C=>(r(),a("button",{key:C.id,type:"button",onClick:L=>B(C.id),class:"w-full text-left p-4 rounded border hover:border-primary hover:bg-primary/5 transition-colors"},[e("div",Yt,[e("div",null,[e("div",Bt,u(C.invoice_number),1),e("div",Wt,u(R(C.invoice_date)),1),e("div",Ht,u(C.items_count)+" item(s) ",1)]),e("div",Gt,[e("div",Qt,"€"+u(C.total.toFixed(2)),1),p[12]||(p[12]=e("div",{class:"text-xs text-primary mt-1"},"View PDF →",-1))])])],8,Lt))),128))]))])])]),_:1})]),_:1},8,["open"]))}}),Xt={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},Zt={class:"flex items-center justify-between gap-2"},Jt={class:"flex gap-2"},Kt={class:"space-y-3"},es={class:"hidden md:flex md:items-center md:justify-between"},ts={class:"flex flex-wrap items-center gap-4"},ss={class:"flex items-center gap-2"},os=["value"],ls={class:"flex items-center gap-2"},rs=["value"],ns={class:"flex items-center gap-2"},is=["value"],as={class:"relative flex-1 max-w-sm"},ds={key:0,class:"flex justify-end"},us={class:"text-right"},cs={class:"text-2xl font-bold"},ms={class:"md:hidden space-y-3"},vs={class:"grid grid-cols-2 gap-3"},fs={class:"space-y-1.5"},ps=["value"],bs={class:"space-y-1.5"},gs=["value"],ys={class:"space-y-1.5"},xs=["value"],ws={class:"relative"},ks={key:0,class:"flex items-center justify-between p-3 bg-muted/50 rounded-lg"},_s={class:"text-xl font-bold"},hs={key:0,class:"text-center py-12 text-muted-foreground"},$s={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 print-cards"},Cs={class:"flex items-start justify-between"},Vs={class:"flex-1"},Ss={class:"space-y-1"},Us={class:"flex items-center gap-1"},Fs={class:"text-xs"},Os={class:"flex gap-1 no-print"},qs={class:"space-y-3"},Ds={key:0,class:"text-sm bg-yellow-50 border-l-2 border-yellow-400 p-2 rounded"},Ms={class:"flex-1"},Ts={class:"font-medium text-blue-700"},js={class:"ml-2"},Is={class:"text-right font-medium text-gray-700"},Es={class:"flex justify-between font-bold bg-linear-to-r from-blue-50 to-orange-50 p-3 rounded-lg"},Ns={class:"text-xl bg-linear-to-r from-blue-600 to-orange-600 bg-clip-text text-transparent"},to=Q({__name:"Index",props:{groupedOrders:{default:()=>[]},groups:{default:()=>[]},menus:{default:()=>[]},currentWeek:{default:1},currentYear:{default:2025},filters:{default:()=>({search:"",group_id:""})}},setup(c){const j=c,g=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Orders",href:"/admin/orders"}],F=S(j.currentWeek),f=S(j.currentYear),y=S(j.filters?.group_id||""),w=S(j.filters?.search||"");let V;const b=S(!0),E=z(()=>Array.from({length:53},(h,s)=>s+1)),v=z(()=>{const h=new Date().getFullYear(),s=[];for(let o=h-3;o<=h+1;o++)s.push(o);return s}),T=()=>{H.get("/admin/orders",{week:F.value,year:f.value,group_id:y.value,search:w.value})},k=()=>{T()},n=()=>{T()},i=()=>{clearTimeout(V),V=setTimeout(()=>{T()},300)},d=h=>new Date(h).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),_=h=>h.special_price??h.weekmenu.menu.price,G=h=>h.quantity*_(h),R=h=>{const s=h.map(o=>o.notes).filter(o=>o!==null&&o!=="");return[...new Set(s)]},B=S(!1),x=()=>{B.value=!1,H.reload()},p=()=>{const h=new URLSearchParams({week:String(F.value),year:String(f.value)});y.value&&h.append("group_id",y.value),w.value&&h.append("search",w.value),window.open(`/admin/orders/pdf?${h.toString()}`,"_blank")},C=()=>{const h=new URLSearchParams({week:String(F.value),year:String(f.value)});y.value&&h.append("group_id",y.value),w.value&&h.append("search",w.value),window.location.href=`/admin/orders/export?${h.toString()}`},L=S(null),X=S(!1),ce=h=>{L.value=h,X.value=!0},me=()=>{X.value=!1,L.value=null,H.reload()},Z=S(null),J=S(!1),ve=h=>{Z.value=h,J.value=!0},fe=()=>{J.value=!1,Z.value=null,H.reload()};return(h,s)=>(r(),a(O,null,[l(t(ye),{title:"Orders"}),l(we,{breadcrumbs:g},{default:m(()=>[e("div",Xt,[e("div",Zt,[s[17]||(s[17]=e("h2",{class:"text-2xl font-bold"},"Orders",-1)),e("div",Jt,[l(t(N),{variant:"outline",size:"sm",onClick:s[0]||(s[0]=o=>b.value=!b.value),class:"md:hidden"},{default:m(()=>[l(t($e),{class:"h-4 w-4"})]),_:1}),l(t(N),{onClick:s[1]||(s[1]=o=>B.value=!0),size:"sm"},{default:m(()=>[...s[14]||(s[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"hidden md:inline"},"Add Order",-1)])]),_:1}),l(t(N),{variant:"outline",onClick:p,size:"sm"},{default:m(()=>[...s[15]||(s[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1),e("span",{class:"hidden md:inline"},"Print",-1)])]),_:1}),l(t(N),{variant:"outline",onClick:C,size:"sm"},{default:m(()=>[...s[16]||(s[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("span",{class:"hidden md:inline"},"Export Excel",-1)])]),_:1})])]),A(e("div",Kt,[e("div",es,[e("div",ts,[e("div",ss,[s[18]||(s[18]=e("label",{for:"week",class:"text-sm font-medium"},"Week:",-1)),A(e("select",{id:"week","onUpdate:modelValue":s[2]||(s[2]=o=>F.value=o),onChange:k,class:"h-10 w-20 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(r(!0),a(O,null,q(E.value,o=>(r(),a("option",{key:o,value:o},u(o),9,os))),128))],544),[[W,F.value,void 0,{number:!0}]])]),e("div",ls,[s[19]||(s[19]=e("label",{for:"year",class:"text-sm font-medium"},"Year:",-1)),A(e("select",{id:"year","onUpdate:modelValue":s[3]||(s[3]=o=>f.value=o),onChange:k,class:"h-10 w-24 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(r(!0),a(O,null,q(v.value,o=>(r(),a("option",{key:o,value:o},u(o),9,rs))),128))],544),[[W,f.value,void 0,{number:!0}]])]),e("div",ns,[s[21]||(s[21]=e("label",{for:"group-filter",class:"text-sm font-medium"},"Group:",-1)),A(e("select",{id:"group-filter","onUpdate:modelValue":s[4]||(s[4]=o=>y.value=o),onChange:n,class:"h-10 w-[200px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[s[20]||(s[20]=e("option",{value:""},"All Groups",-1)),(r(!0),a(O,null,q(c.groups,o=>(r(),a("option",{key:o.id,value:String(o.id)},u(o.name),9,is))),128))],544),[[W,y.value]])]),e("div",as,[l(t(ie),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),l(t(P),{modelValue:w.value,"onUpdate:modelValue":s[5]||(s[5]=o=>w.value=o),onInput:i,type:"search",placeholder:"Search by client or menu name...",class:"pl-9"},null,8,["modelValue"])])]),c.groupedOrders.length>0?(r(),a("div",ds,[e("div",us,[s[22]||(s[22]=e("div",{class:"text-sm text-muted-foreground"},"Total Orders",-1)),e("div",cs," €"+u(c.groupedOrders.reduce((o,I)=>o+I.total,0).toFixed(2)),1)])])):U("",!0)]),e("div",ms,[e("div",vs,[e("div",fs,[s[23]||(s[23]=e("label",{for:"week-mobile",class:"text-sm font-medium"},"Week",-1)),A(e("select",{id:"week-mobile","onUpdate:modelValue":s[6]||(s[6]=o=>F.value=o),onChange:k,class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(r(!0),a(O,null,q(E.value,o=>(r(),a("option",{key:o,value:o},u(o),9,ps))),128))],544),[[W,F.value,void 0,{number:!0}]])]),e("div",bs,[s[24]||(s[24]=e("label",{for:"year-mobile",class:"text-sm font-medium"},"Year",-1)),A(e("select",{id:"year-mobile","onUpdate:modelValue":s[7]||(s[7]=o=>f.value=o),onChange:k,class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(r(!0),a(O,null,q(v.value,o=>(r(),a("option",{key:o,value:o},u(o),9,gs))),128))],544),[[W,f.value,void 0,{number:!0}]])])]),e("div",ys,[s[26]||(s[26]=e("label",{for:"group-filter-mobile",class:"text-sm font-medium"},"Group",-1)),A(e("select",{id:"group-filter-mobile","onUpdate:modelValue":s[8]||(s[8]=o=>y.value=o),onChange:n,class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[s[25]||(s[25]=e("option",{value:""},"All Groups",-1)),(r(!0),a(O,null,q(c.groups,o=>(r(),a("option",{key:o.id,value:String(o.id)},u(o.name),9,xs))),128))],544),[[W,y.value]])]),e("div",ws,[l(t(ie),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),l(t(P),{modelValue:w.value,"onUpdate:modelValue":s[9]||(s[9]=o=>w.value=o),onInput:i,type:"search",placeholder:"Search...",class:"pl-9"},null,8,["modelValue"])]),c.groupedOrders.length>0?(r(),a("div",ks,[s[27]||(s[27]=e("span",{class:"text-sm font-medium"},"Total Orders",-1)),e("span",_s," €"+u(c.groupedOrders.reduce((o,I)=>o+I.total,0).toFixed(2)),1)])):U("",!0)])],512),[[xe,b.value]]),c.groupedOrders.length===0?(r(),a("div",hs," No orders found for the selected filters. ")):U("",!0),e("div",$s,[(r(!0),a(O,null,q(c.groupedOrders,o=>(r(),Y(t(Ve),{key:o.user.id,class:"border-l-4 border-blue-400 bg-linear-to-br from-blue-50/50 via-white to-orange-50/30 hover:shadow-lg transition-shadow"},{default:m(()=>[l(t(Fe),{class:"bg-linear-to-r from-blue-50 to-orange-50 border-b border-blue-100"},{default:m(()=>[e("div",Cs,[e("div",Vs,[l(t(Oe),{class:"text-blue-900"},{default:m(()=>[$(u(o.user.name),1)]),_:2},1024),l(t(Ue),null,{default:m(()=>[e("div",Ss,[e("div",Us,[s[28]||(s[28]=e("span",{class:"inline-block w-2 h-2 bg-orange-400 rounded-full"},null,-1)),e("span",null,u(o.group?.name??"No Group"),1)]),e("div",Fs,u(d(o.order_date)),1)])]),_:2},1024)]),e("div",Os,[l(t(N),{size:"sm",variant:"ghost",onClick:I=>ce(o),class:"hover:bg-blue-100 hover:text-blue-700"},{default:m(()=>[l(t(De),{class:"h-4 w-4"})]),_:1},8,["onClick"]),l(t(N),{size:"sm",variant:"ghost",onClick:I=>ve(o),class:"hover:bg-orange-100 hover:text-orange-700"},{default:m(()=>[l(t(qe),{class:"h-4 w-4"})]),_:1},8,["onClick"])])])]),_:2},1024),l(t(Se),null,{default:m(()=>[e("div",qs,[R(o.orders).length>0?(r(),a("div",Ds,[s[29]||(s[29]=e("div",{class:"font-medium mb-1 text-yellow-800"},"Notes:",-1)),(r(!0),a(O,null,q(R(o.orders),(I,pe)=>(r(),a("div",{key:pe,class:"text-yellow-700"}," • "+u(I),1))),128)),s[30]||(s[30]=e("div",{class:"border-t border-yellow-200 mt-3 mb-3"},null,-1))])):U("",!0),(r(!0),a(O,null,q(o.orders,I=>(r(),a("div",{key:I.id,class:"flex justify-between text-sm hover:bg-blue-50 p-2 rounded transition-colors"},[e("div",Ms,[e("span",Ts,u(I.quantity)+"×",1),e("span",js,u(I.weekmenu.menu.label),1)]),e("div",Is," €"+u(G(I).toFixed(2)),1)]))),128)),s[32]||(s[32]=e("div",{class:"border-t border-blue-200"},null,-1)),e("div",Es,[s[31]||(s[31]=e("span",{class:"text-gray-700"},"Total",-1)),e("span",Ns," €"+u(o.total.toFixed(2)),1)])])]),_:2},1024)]),_:2},1024))),128))])])]),_:1}),l(t(te),{open:B.value,"onUpdate:open":s[11]||(s[11]=o=>B.value=o)},{default:m(()=>[l(t(se),{class:"max-w-md"},{default:m(()=>[l(t(oe),null,{default:m(()=>[l(t(le),null,{default:m(()=>[...s[33]||(s[33]=[$("Add Order",-1)])]),_:1}),l(t(re),null,{default:m(()=>[...s[34]||(s[34]=[$("Create a new order for a client",-1)])]),_:1})]),_:1}),l(ue,{week:c.currentWeek,year:c.currentYear,menus:c.menus,groups:c.groups,onSuccess:x,onCancel:s[10]||(s[10]=o=>B.value=!1)},null,8,["week","year","menus","groups"])]),_:1})]),_:1},8,["open"]),L.value?(r(),Y(_t,{key:0,order:L.value,open:X.value,menus:c.menus,groups:c.groups,"onUpdate:open":s[12]||(s[12]=o=>X.value=o),onSuccess:me},null,8,["order","open","menus","groups"])):U("",!0),Z.value?(r(),Y(Rt,{key:1,order:Z.value,open:J.value,"onUpdate:open":s[13]||(s[13]=o=>J.value=o),onSuccess:fe},null,8,["order","open"])):U("",!0)],64))}});export{to as default};
