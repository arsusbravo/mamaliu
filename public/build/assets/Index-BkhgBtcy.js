import{d as G,j as V,k as z,m as be,c as a,b as e,f as C,G as I,t as u,a as r,u as t,F,r as O,e as H,o as i,q as K,z as ie,w as d,g as k,H as E,J as L,s as ge,K as re,i as B,h as ye,L as xe}from"./app-Xnm7XAGS.js";import{_ as we}from"./AppLayout.vue_vue_type_script_setup_true_lang-CtbwN_CL.js";import{a as N,_ as q}from"./Label.vue_vue_type_script_setup_true_lang-DsNotVKA.js";import{c as ae,_ as A}from"./index-BZWujIKO.js";import{_ as Z,a as ee,b as te,c as se,d as oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DsFCyM1O.js";import{_ as ke}from"./Textarea.vue_vue_type_script_setup_true_lang-BqnwKue4.js";import{C as _e}from"./check-CNjgEXjH.js";import{_ as he,F as $e}from"./FormWeekmenu.vue_vue_type_script_setup_true_lang-PzBBrHtr.js";import{X as Ce}from"./x-DY1rFcdW.js";import{_ as Ve,a as Se}from"./CardContent.vue_vue_type_script_setup_true_lang-Dnh3ZWkP.js";import{_ as Ue}from"./CardDescription.vue_vue_type_script_setup_true_lang-CBgynyaW.js";import{_ as Fe,a as Oe}from"./CardTitle.vue_vue_type_script_setup_true_lang-DhB2FHSF.js";import{S as ne}from"./search-DVmkXS8a.js";import"./Presence-B_gSEmy3.js";import"./VisuallyHidden-BBgbru7N.js";import"./index-B8We5vQ-.js";import"./shopping-bag-mkdli9jn.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-BNXNyLRp.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-Bit2u2nR.js";import"./useFormControl-DhRWnaD3.js";import"./image-off-CDxTCFpq.js";const qe=ae("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const De=ae("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Te={class:"grid gap-2"},je=["disabled"],Me={key:0,class:"flex flex-col"},Ae={class:"font-medium"},Ie={class:"text-xs text-muted-foreground"},Ee={key:1,class:"text-muted-foreground"},Ne={key:0,class:"relative"},ze={class:"absolute z-50 w-full mt-1 bg-background border rounded-md shadow-lg"},We={class:"p-2 border-b"},Pe={class:"max-h-64 overflow-y-auto"},Ye={class:"p-1"},Le=["onClick"],Be={class:"flex flex-col text-left"},He={class:"font-medium"},Ge={class:"text-xs text-muted-foreground"},Qe={key:0,class:"p-4 text-center text-muted-foreground"},Re={key:1,class:"text-sm text-red-500"},de=G({__name:"ClientSelector",props:{modelValue:{default:null},error:{default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(c,{emit:T}){const b=c,S=T,v=V(""),g=V(!1),_=V([]),U=z(()=>!b.modelValue||!_.value?null:_.value.find(x=>x.id===b.modelValue)),p=z(()=>{if(!v.value)return _.value;const x=v.value.toLowerCase();return _.value.filter(n=>n.name.toLowerCase().includes(x)||n.email.toLowerCase().includes(x))}),m=async()=>{try{const n=await(await fetch("/admin/clients/list")).json();_.value=n.clients||[]}catch(x){console.error("Failed to load clients:",x)}},D=x=>{S("update:modelValue",x),g.value=!1,v.value=""},j=()=>{b.disabled||(g.value=!g.value,g.value&&_.value.length===0&&m())};return be(()=>{b.modelValue&&m()}),(x,n)=>(i(),a("div",Te,[e("button",{type:"button",onClick:j,disabled:c.disabled,class:I(["flex items-center justify-between gap-3 w-full px-3 py-2 text-left border rounded-md bg-background hover:bg-accent",c.error?"border-red-500":"border-input",c.disabled?"opacity-50 cursor-not-allowed":""])},[U.value?(i(),a("div",Me,[e("span",Ae,u(U.value.name),1),e("span",Ie,u(U.value.email),1)])):(i(),a("span",Ee,"Select a client")),n[1]||(n[1]=e("svg",{class:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))],10,je),g.value?(i(),a("div",Ne,[e("div",ze,[e("div",We,[r(t(N),{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=s=>v.value=s),type:"text",placeholder:"Search by name or email...",class:"w-full"},null,8,["modelValue"])]),e("div",Pe,[e("div",Ye,[(i(!0),a(F,null,O(p.value,s=>(i(),a("button",{key:s.id,type:"button",onClick:w=>D(s.id),class:"flex items-center justify-between w-full px-3 py-2 rounded hover:bg-accent transition-colors"},[e("div",Be,[e("span",He,u(s.name),1),e("span",Ge,u(s.email),1)]),s.id===c.modelValue?(i(),H(t(_e),{key:0,class:"w-4 h-4 text-primary shrink-0"})):C("",!0)],8,Le))),128)),p.value.length===0?(i(),a("div",Qe," No clients found ")):C("",!0)])])])])):C("",!0),c.error?(i(),a("span",Re,u(c.error),1)):C("",!0)]))}}),Xe={class:"grid grid-cols-2 gap-4"},Je={key:0,class:"text-sm text-red-500 mt-1"},Ke={key:0,class:"text-sm text-red-500 mt-1"},Ze={class:"flex items-center justify-between mb-2"},et=["value"],tt={key:0,class:"text-sm text-red-500 mt-1"},st={key:1,class:"text-sm text-muted-foreground mt-1"},ot={key:0,class:"text-sm text-red-500 mt-1"},lt={class:"flex justify-end gap-2"},ue=G({__name:"FormOrder",props:{order:{default:null},user_id:{default:null},week:{},year:{},menus:{},groups:{}},emits:["success","cancel"],setup(c,{emit:T}){const b=c,S=T,v=V([]),g=V(!1),_=V(!1),U=new Date,p=n=>{const s=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),w=s.getUTCDay()||7;s.setUTCDate(s.getUTCDate()+4-w);const P=new Date(Date.UTC(s.getUTCFullYear(),0,1));return Math.ceil(((s.getTime()-P.getTime())/864e5+1)/7)},m=K({user_id:b.order?.user_id||b.user_id||null,weekmenu_id:b.order?.weekmenu_id||null,quantity:b.order?.quantity||1,notes:b.order?.notes||"",week:b.order?.week||b.week||p(U),year:b.order?.year||b.year||U.getFullYear()}),D=async()=>{try{g.value=!0;const s=await(await fetch(`/admin/weekmenus/list?week=${m.week}&year=${m.year}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();v.value=s.weekmenus||[]}catch(n){console.error("Failed to load weekmenus:",n)}finally{g.value=!1}};ie([()=>m.week,()=>m.year],()=>{D()}),D();const j=()=>{b.order?.id?m.put(`/admin/orders/${b.order.id}`,{preserveScroll:!0,onSuccess:()=>{S("success")}}):m.post("/admin/orders",{preserveScroll:!0,onSuccess:()=>{S("success")}})},x=()=>{_.value=!1,D()};return(n,s)=>(i(),a(F,null,[e("form",{onSubmit:ge(j,["prevent"]),class:"space-y-4"},[e("div",Xe,[e("div",null,[r(t(q),{for:"week"},{default:d(()=>[...s[10]||(s[10]=[k("Week *",-1)])]),_:1}),r(t(N),{id:"week",modelValue:t(m).week,"onUpdate:modelValue":s[0]||(s[0]=w=>t(m).week=w),modelModifiers:{number:!0},type:"number",min:"1",max:"53",disabled:!!c.order,class:I({"border-red-500":t(m).errors.week})},null,8,["modelValue","disabled","class"]),t(m).errors.week?(i(),a("p",Je,u(t(m).errors.week),1)):C("",!0)]),e("div",null,[r(t(q),{for:"year"},{default:d(()=>[...s[11]||(s[11]=[k("Year *",-1)])]),_:1}),r(t(N),{id:"year",modelValue:t(m).year,"onUpdate:modelValue":s[1]||(s[1]=w=>t(m).year=w),modelModifiers:{number:!0},type:"number",min:"2020",max:"2100",disabled:!!c.order,class:I({"border-red-500":t(m).errors.year})},null,8,["modelValue","disabled","class"]),t(m).errors.year?(i(),a("p",Ke,u(t(m).errors.year),1)):C("",!0)])]),e("div",null,[r(t(q),null,{default:d(()=>[...s[12]||(s[12]=[k("Client *",-1)])]),_:1}),r(de,{modelValue:t(m).user_id,"onUpdate:modelValue":s[2]||(s[2]=w=>t(m).user_id=w),error:t(m).errors.user_id,disabled:!!c.order},null,8,["modelValue","error","disabled"])]),e("div",null,[e("div",Ze,[r(t(q),{for:"weekmenu"},{default:d(()=>[...s[13]||(s[13]=[k("Menu *",-1)])]),_:1}),r(t(A),{type:"button",variant:"link",size:"sm",class:"h-auto p-0",onClick:s[3]||(s[3]=w=>_.value=!0)},{default:d(()=>[...s[14]||(s[14]=[k(" + Add Menu to Week ",-1)])]),_:1})]),E(e("select",{id:"weekmenu","onUpdate:modelValue":s[4]||(s[4]=w=>t(m).weekmenu_id=w),class:I(["h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",{"border-red-500":t(m).errors.weekmenu_id}])},[s[15]||(s[15]=e("option",{value:null},"Select a menu",-1)),(i(!0),a(F,null,O(v.value,w=>(i(),a("option",{key:w.id,value:w.id},u(w.menu.label)+" (€"+u(w.menu.price.toFixed(2))+") ",9,et))),128))],2),[[L,t(m).weekmenu_id]]),t(m).errors.weekmenu_id?(i(),a("p",tt,u(t(m).errors.weekmenu_id),1)):C("",!0),!g.value&&v.value.length===0?(i(),a("p",st," No menus available for this week. Add one using the button above. ")):C("",!0)]),e("div",null,[r(t(q),{for:"quantity"},{default:d(()=>[...s[16]||(s[16]=[k("Quantity *",-1)])]),_:1}),r(t(N),{id:"quantity",modelValue:t(m).quantity,"onUpdate:modelValue":s[5]||(s[5]=w=>t(m).quantity=w),modelModifiers:{number:!0},type:"number",min:"1",class:I({"border-red-500":t(m).errors.quantity})},null,8,["modelValue","class"]),t(m).errors.quantity?(i(),a("p",ot,u(t(m).errors.quantity),1)):C("",!0)]),e("div",null,[r(t(q),{for:"notes"},{default:d(()=>[...s[17]||(s[17]=[k("Notes",-1)])]),_:1}),r(t(ke),{id:"notes",modelValue:t(m).notes,"onUpdate:modelValue":s[6]||(s[6]=w=>t(m).notes=w),rows:"3",placeholder:"Optional notes..."},null,8,["modelValue"])]),e("div",lt,[r(t(A),{type:"button",variant:"outline",onClick:s[7]||(s[7]=w=>S("cancel"))},{default:d(()=>[...s[18]||(s[18]=[k(" Cancel ",-1)])]),_:1}),r(t(A),{type:"submit",disabled:t(m).processing},{default:d(()=>[k(u(c.order?"Update":"Add")+" Order ",1)]),_:1},8,["disabled"])])],32),r(t(Z),{open:_.value,"onUpdate:open":s[9]||(s[9]=w=>_.value=w)},{default:d(()=>[r(t(ee),null,{default:d(()=>[r(t(te),null,{default:d(()=>[r(t(se),null,{default:d(()=>[k("Add Menu to Week "+u(t(m).week)+", "+u(t(m).year),1)]),_:1}),r(t(oe),null,{default:d(()=>[...s[19]||(s[19]=[k("Add a menu to this week",-1)])]),_:1})]),_:1}),r(he,{menus:c.menus,groups:c.groups,defaultWeek:t(m).week,defaultYear:t(m).year,submitUrl:"/admin/weekmenus",method:"post",onSuccess:x,onCancel:s[8]||(s[8]=w=>_.value=!1)},null,8,["menus","groups","defaultWeek","defaultYear"])]),_:1})]),_:1},8,["open"])],64))}}),rt={class:"flex gap-2 border-b"},nt={key:0,class:"space-y-4 mt-4"},it={class:"space-y-2"},at={class:"flex items-center space-x-2 cursor-pointer"},dt={class:"text-sm"},ut={class:"flex items-center space-x-2 cursor-pointer"},ct={class:"text-sm"},mt={key:1,class:"space-y-4 mt-4"},vt={class:"space-y-2 mt-2"},ft=["onClick"],pt={class:"flex justify-between items-center"},bt={class:"font-medium"},gt={class:"text-sm text-muted-foreground"},yt={class:"font-semibold"},xt={key:0,class:"space-y-4 p-4 border rounded-lg bg-gray-50"},wt={key:2,class:"mt-4"},kt=G({__name:"EditOrderDialog",props:{order:{},open:{type:Boolean},menus:{},groups:{}},emits:["update:open","success"],setup(c,{emit:T}){const b=c,S=T,v=V("change-client"),g=K({new_user_id:null,action:"move"}),_=()=>{if(!g.new_user_id){alert("Please select a client");return}const x=b.order.orders[0]?.week,n=b.order.orders[0]?.year;B.post(`/admin/orders/change-client/${b.order.user.id}`,{new_user_id:g.new_user_id,action:g.action,week:x,year:n},{preserveScroll:!0,onSuccess:()=>{S("success")},onError:s=>{console.error("Change client errors:",s)}})},U=V(null),p=K({quantity:1,special_price:""}),m=x=>{U.value=x;const n=b.order.orders.find(s=>s.id===x);n&&(p.quantity=n.quantity,p.special_price=n.special_price??"")},D=()=>{if(!U.value){alert("Please select an order to edit");return}B.put(`/admin/orders/${U.value}`,{quantity:p.quantity,special_price:p.special_price||null},{preserveScroll:!0,onSuccess:()=>{U.value=null,S("success")},onError:x=>{console.error("Update order errors:",x)}})},j=()=>{S("success")};return(x,n)=>(i(),H(t(Z),{open:c.open,"onUpdate:open":n[8]||(n[8]=s=>S("update:open",s))},{default:d(()=>[r(t(ee),{class:"max-w-2xl max-h-[90vh] overflow-y-auto"},{default:d(()=>[r(t(te),null,{default:d(()=>[r(t(se),null,{default:d(()=>[k("Edit Orders for "+u(c.order.user.name),1)]),_:1}),r(t(oe),null,{default:d(()=>[...n[9]||(n[9]=[k("Manage orders for this client",-1)])]),_:1})]),_:1}),e("div",rt,[e("button",{onClick:n[0]||(n[0]=s=>v.value="change-client"),class:I(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",v.value==="change-client"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Change Client ",2),e("button",{onClick:n[1]||(n[1]=s=>v.value="edit-quantities"),class:I(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",v.value==="edit-quantities"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Edit Orders ",2),e("button",{onClick:n[2]||(n[2]=s=>v.value="add-order"),class:I(["px-4 py-2 font-medium text-sm border-b-2 transition-colors",v.value==="add-order"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])}," Add Order ",2)]),v.value==="change-client"?(i(),a("div",nt,[e("div",null,[r(t(q),null,{default:d(()=>[...n[10]||(n[10]=[k("Select New Client",-1)])]),_:1}),r(de,{modelValue:t(g).new_user_id,"onUpdate:modelValue":n[3]||(n[3]=s=>t(g).new_user_id=s)},null,8,["modelValue"])]),e("div",null,[r(t(q),{class:"mb-2 block"},{default:d(()=>[...n[11]||(n[11]=[k("Action",-1)])]),_:1}),e("div",it,[e("label",at,[E(e("input",{type:"radio",value:"move","onUpdate:modelValue":n[4]||(n[4]=s=>t(g).action=s),class:"h-4 w-4 text-primary"},null,512),[[re,t(g).action]]),e("span",dt,"Move all orders (remove from "+u(c.order.user.name)+")",1)]),e("label",ut,[E(e("input",{type:"radio",value:"copy","onUpdate:modelValue":n[5]||(n[5]=s=>t(g).action=s),class:"h-4 w-4 text-primary"},null,512),[[re,t(g).action]]),e("span",ct,"Copy all orders (keep on "+u(c.order.user.name)+")",1)])])]),r(t(A),{onClick:_,disabled:!t(g).new_user_id,class:"w-full"},{default:d(()=>[k(u(t(g).action==="move"?"Move":"Copy")+" Orders ",1)]),_:1},8,["disabled"])])):C("",!0),v.value==="edit-quantities"?(i(),a("div",mt,[e("div",null,[r(t(q),null,{default:d(()=>[...n[12]||(n[12]=[k("Select Order to Edit",-1)])]),_:1}),e("div",vt,[(i(!0),a(F,null,O(c.order.orders,s=>(i(),a("button",{key:s.id,type:"button",onClick:w=>m(s.id),class:I(["w-full text-left p-3 rounded border transition-colors",U.value===s.id?"border-primary bg-primary/5":"border-gray-200 hover:border-primary/50"])},[e("div",pt,[e("div",null,[e("div",bt,u(s.quantity)+"× "+u(s.weekmenu.menu.label),1),e("div",gt,u(s.special_price?`€${s.special_price.toFixed(2)}`:`€${s.weekmenu.menu.price.toFixed(2)}`)+" each ",1)]),e("div",yt," €"+u(((s.special_price??s.weekmenu.menu.price)*s.quantity).toFixed(2)),1)])],10,ft))),128))])]),U.value?(i(),a("div",xt,[e("div",null,[r(t(q),{for:"quantity"},{default:d(()=>[...n[13]||(n[13]=[k("Quantity",-1)])]),_:1}),r(t(N),{id:"quantity",modelValue:t(p).quantity,"onUpdate:modelValue":n[6]||(n[6]=s=>t(p).quantity=s),modelModifiers:{number:!0},type:"number",min:"1"},null,8,["modelValue"])]),e("div",null,[r(t(q),{for:"special_price"},{default:d(()=>[...n[14]||(n[14]=[k("Special Price (optional)",-1)])]),_:1}),r(t(N),{id:"special_price",modelValue:t(p).special_price,"onUpdate:modelValue":n[7]||(n[7]=s=>t(p).special_price=s),type:"number",step:"0.01",min:"0",placeholder:"Leave empty for default price"},null,8,["modelValue"])]),r(t(A),{onClick:D,class:"w-full"},{default:d(()=>[...n[15]||(n[15]=[k(" Update Order ",-1)])]),_:1})])):C("",!0)])):C("",!0),v.value==="add-order"?(i(),a("div",wt,[r(ue,{user_id:c.order.user.id,week:c.order.orders[0]?.week,year:c.order.orders[0]?.year,menus:c.menus,groups:c.groups,onSuccess:j,onCancel:()=>{}},null,8,["user_id","week","year","menus","groups"])])):C("",!0)]),_:1})]),_:1},8,["open"]))}}),_t={class:"grid grid-cols-2 gap-6"},ht={class:"space-y-4"},$t={key:0,class:"text-sm text-red-500 mt-1"},Ct={key:0,class:"text-sm text-red-500 mt-1"},Vt={class:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-2"},St=["onClick"],Ut={class:"flex-1"},Ft={class:"font-medium"},Ot={class:"text-sm text-muted-foreground"},qt={class:"flex items-center gap-3"},Dt={class:"font-semibold"},Tt={class:"border-t pt-4 space-y-2"},jt={class:"flex justify-between text-sm"},Mt={class:"flex justify-between text-sm"},At={class:"flex justify-between font-bold text-lg border-t pt-2"},It={class:"space-y-4"},Et={key:0,class:"text-center py-8 text-muted-foreground"},Nt={key:1,class:"text-center py-8 text-muted-foreground"},zt={key:2,class:"space-y-2 max-h-[500px] overflow-y-auto"},Wt=["onClick"],Pt={class:"flex justify-between items-start"},Yt={class:"font-semibold"},Lt={class:"text-sm text-muted-foreground"},Bt={class:"text-xs text-muted-foreground mt-1"},Ht={class:"text-right"},Gt={class:"font-bold"},Qt=G({__name:"InvoiceDialog",props:{order:{},open:{type:Boolean}},emits:["update:open","success"],setup(c,{emit:T}){const b=c,S=T,v=V(b.order.orders.map(y=>y.id)),g=V([]),_=V(!1),U=z(()=>{const y=b.order.orders[0]?.year||new Date().getFullYear(),f=b.order.orders[0]?.week||1,$=String(f).padStart(2,"0"),W=String(b.order.user.id).padStart(5,"0");return`${y}${$}${W}`}),p=K({invoice_number:U.value,invoice_date:new Date().toISOString().split("T")[0],user_id:b.order.user.id,order_ids:v.value}),m=z(()=>b.order.orders.filter(y=>v.value.includes(y.id))),D=y=>y.special_price??y.weekmenu.menu.price,j=y=>y.quantity*D(y),x=z(()=>m.value.reduce((y,f)=>y+j(f),0)),n=z(()=>x.value/1.09),s=z(()=>x.value-n.value),w=y=>{const f=v.value.indexOf(y);f>-1?v.value.splice(f,1):v.value.push(y)},P=async()=>{_.value=!0;try{const f=await(await fetch(`/admin/invoices/by-user/${b.order.user.id}`)).json();g.value=f.invoices||[]}catch(y){console.error("Failed to load invoices:",y)}finally{_.value=!1}};P(),ie(()=>b.order.user.id,()=>{P(),p.invoice_number=U.value,p.invoice_date=new Date().toISOString().split("T")[0],p.user_id=b.order.user.id,v.value=b.order.orders.map(y=>y.id)});const le=()=>{if(v.value.length===0){alert("Please select at least one order");return}p.order_ids=v.value,B.post("/admin/invoices",p.data(),{preserveScroll:!0,onSuccess:()=>{P(),p.invoice_number=U.value,p.invoice_date=new Date().toISOString().split("T")[0],v.value=b.order.orders.map(y=>y.id)},onError:y=>{console.error("Invoice creation errors:",y)}})},Q=y=>new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Y=y=>{window.open(`/admin/invoices/${y}/pdf`,"_blank")};return(y,f)=>(i(),H(t(Z),{open:c.open,"onUpdate:open":f[2]||(f[2]=$=>S("update:open",$))},{default:d(()=>[r(t(ee),{class:"max-w-6xl max-h-[90vh] overflow-y-auto"},{default:d(()=>[r(t(te),null,{default:d(()=>[r(t(se),null,{default:d(()=>[k("Generate Invoice for "+u(c.order.user.name),1)]),_:1}),r(t(oe),null,{default:d(()=>[...f[3]||(f[3]=[k("Create a new invoice or view existing invoices",-1)])]),_:1})]),_:1}),e("div",_t,[e("div",ht,[f[11]||(f[11]=e("h3",{class:"text-lg font-semibold"},"New Invoice",-1)),e("div",null,[r(t(q),{for:"invoice_number"},{default:d(()=>[...f[4]||(f[4]=[k("Invoice Number *",-1)])]),_:1}),r(t(N),{id:"invoice_number",modelValue:t(p).invoice_number,"onUpdate:modelValue":f[0]||(f[0]=$=>t(p).invoice_number=$),class:I({"border-red-500":t(p).errors.invoice_number})},null,8,["modelValue","class"]),t(p).errors.invoice_number?(i(),a("p",$t,u(t(p).errors.invoice_number),1)):C("",!0)]),e("div",null,[r(t(q),{for:"invoice_date"},{default:d(()=>[...f[5]||(f[5]=[k("Invoice Date *",-1)])]),_:1}),r(t(N),{id:"invoice_date",type:"date",modelValue:t(p).invoice_date,"onUpdate:modelValue":f[1]||(f[1]=$=>t(p).invoice_date=$),class:I({"border-red-500":t(p).errors.invoice_date})},null,8,["modelValue","class"]),t(p).errors.invoice_date?(i(),a("p",Ct,u(t(p).errors.invoice_date),1)):C("",!0)]),e("div",null,[r(t(q),{class:"mb-2 block"},{default:d(()=>[...f[6]||(f[6]=[k("Orders (click to remove)",-1)])]),_:1}),e("div",Vt,[(i(!0),a(F,null,O(c.order.orders,$=>(i(),a("button",{key:$.id,type:"button",onClick:W=>w($.id),class:I(["w-full text-left p-3 rounded border transition-colors flex items-center justify-between",v.value.includes($.id)?"border-primary bg-primary/5":"border-gray-300 bg-gray-100 opacity-50"])},[e("div",Ut,[e("div",Ft,u($.quantity)+"× "+u($.weekmenu.menu.label),1),e("div",Ot," €"+u(D($).toFixed(2))+" each ",1)]),e("div",qt,[e("span",Dt,"€"+u(j($).toFixed(2)),1),v.value.includes($.id)?(i(),H(t(Ce),{key:0,class:"h-4 w-4 text-red-500"})):C("",!0)])],10,St))),128))])]),e("div",Tt,[e("div",jt,[f[7]||(f[7]=e("span",null,"Total Excl. VAT",-1)),e("span",null,"€"+u(n.value.toFixed(2)),1)]),e("div",Mt,[f[8]||(f[8]=e("span",null,"VAT (9%)",-1)),e("span",null,"€"+u(s.value.toFixed(2)),1)]),e("div",At,[f[9]||(f[9]=e("span",null,"Total Incl. VAT",-1)),e("span",null,"€"+u(x.value.toFixed(2)),1)])]),r(t(A),{onClick:le,disabled:v.value.length===0||t(p).processing,class:"w-full"},{default:d(()=>[...f[10]||(f[10]=[k(" Generate Invoice ",-1)])]),_:1},8,["disabled"])]),e("div",It,[f[13]||(f[13]=e("h3",{class:"text-lg font-semibold"},"Existing Invoices",-1)),_.value?(i(),a("div",Et," Loading invoices... ")):g.value.length===0?(i(),a("div",Nt," No invoices found for this client ")):(i(),a("div",zt,[(i(!0),a(F,null,O(g.value,$=>(i(),a("button",{key:$.id,type:"button",onClick:W=>Y($.id),class:"w-full text-left p-4 rounded border hover:border-primary hover:bg-primary/5 transition-colors"},[e("div",Pt,[e("div",null,[e("div",Yt,u($.invoice_number),1),e("div",Lt,u(Q($.invoice_date)),1),e("div",Bt,u($.items_count)+" item(s) ",1)]),e("div",Ht,[e("div",Gt,"€"+u($.total.toFixed(2)),1),f[12]||(f[12]=e("div",{class:"text-xs text-primary mt-1"},"View PDF →",-1))])])],8,Wt))),128))]))])])]),_:1})]),_:1},8,["open"]))}}),Rt={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},Xt={class:"flex items-center justify-between gap-2"},Jt={class:"flex gap-2"},Kt={class:"space-y-3"},Zt={class:"hidden md:flex md:items-center md:justify-between"},es={class:"flex flex-wrap items-center gap-4"},ts={class:"flex items-center gap-2"},ss=["value"],os={class:"flex items-center gap-2"},ls=["value"],rs={class:"flex items-center gap-2"},ns=["value"],is={class:"relative flex-1 max-w-sm"},as={key:0,class:"flex justify-end"},ds={class:"text-right"},us={class:"text-2xl font-bold"},cs={class:"md:hidden space-y-3"},ms={class:"grid grid-cols-2 gap-3"},vs={class:"space-y-1.5"},fs=["value"],ps={class:"space-y-1.5"},bs=["value"],gs={class:"space-y-1.5"},ys=["value"],xs={class:"relative"},ws={key:0,class:"flex items-center justify-between p-3 bg-muted/50 rounded-lg"},ks={class:"text-xl font-bold"},_s={key:0,class:"text-center py-12 text-muted-foreground"},hs={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 print-cards"},$s={class:"flex items-start justify-between"},Cs={class:"flex-1"},Vs={class:"space-y-1"},Ss={class:"flex items-center gap-1"},Us={class:"text-xs"},Fs={class:"flex gap-1 no-print"},Os={class:"space-y-3"},qs={key:0,class:"text-sm bg-yellow-50 border-l-2 border-yellow-400 p-2 rounded"},Ds={class:"flex-1"},Ts={class:"font-medium text-blue-700"},js={class:"ml-2"},Ms={class:"text-right font-medium text-gray-700"},As={class:"flex justify-between font-bold bg-linear-to-r from-blue-50 to-orange-50 p-3 rounded-lg"},Is={class:"text-xl bg-linear-to-r from-blue-600 to-orange-600 bg-clip-text text-transparent"},ro=G({__name:"Index",props:{groupedOrders:{default:()=>[]},groups:{default:()=>[]},menus:{default:()=>[]},currentWeek:{default:1},currentYear:{default:2025},filters:{default:()=>({search:"",group_id:""})}},setup(c){const T=c,b=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Orders",href:"/admin/orders"}],S=V(T.currentWeek),v=V(T.currentYear),g=V(T.filters?.group_id||""),_=V(T.filters?.search||"");let U;const p=V(!0),m=z(()=>Array.from({length:53},(h,o)=>o+1)),D=z(()=>{const h=new Date().getFullYear(),o=[];for(let l=h-3;l<=h+1;l++)o.push(l);return o}),j=()=>{B.get("/admin/orders",{week:S.value,year:v.value,group_id:g.value,search:_.value})},x=()=>{j()},n=()=>{j()},s=()=>{clearTimeout(U),U=setTimeout(()=>{j()},300)},w=h=>new Date(h).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),P=h=>h.special_price??h.weekmenu.menu.price,le=h=>h.quantity*P(h),Q=h=>{const o=h.map(l=>l.notes).filter(l=>l!==null&&l!=="");return[...new Set(o)]},Y=V(!1),y=()=>{Y.value=!1,B.reload()},f=()=>{const h=new URLSearchParams({week:String(S.value),year:String(v.value)});g.value&&h.append("group_id",g.value),_.value&&h.append("search",_.value),window.open(`/admin/orders/pdf?${h.toString()}`,"_blank")},$=()=>{const h=new URLSearchParams({week:String(S.value),year:String(v.value)});g.value&&h.append("group_id",g.value),_.value&&h.append("search",_.value),window.location.href=`/admin/orders/export?${h.toString()}`},W=V(null),R=V(!1),ce=h=>{W.value=h,R.value=!0},me=()=>{R.value=!1,W.value=null,B.reload()},X=V(null),J=V(!1),ve=h=>{X.value=h,J.value=!0},fe=()=>{J.value=!1,X.value=null,B.reload()};return(h,o)=>(i(),a(F,null,[r(t(ye),{title:"Orders"}),r(we,{breadcrumbs:b},{default:d(()=>[e("div",Rt,[e("div",Xt,[o[17]||(o[17]=e("h2",{class:"text-2xl font-bold"},"Orders",-1)),e("div",Jt,[r(t(A),{variant:"outline",size:"sm",onClick:o[0]||(o[0]=l=>p.value=!p.value),class:"md:hidden"},{default:d(()=>[r(t($e),{class:"h-4 w-4"})]),_:1}),r(t(A),{onClick:o[1]||(o[1]=l=>Y.value=!0),size:"sm"},{default:d(()=>[...o[14]||(o[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"hidden md:inline"},"Add Order",-1)])]),_:1}),r(t(A),{variant:"outline",onClick:f,size:"sm"},{default:d(()=>[...o[15]||(o[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1),e("span",{class:"hidden md:inline"},"Print",-1)])]),_:1}),r(t(A),{variant:"outline",onClick:$,size:"sm"},{default:d(()=>[...o[16]||(o[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("span",{class:"hidden md:inline"},"Export Excel",-1)])]),_:1})])]),E(e("div",Kt,[e("div",Zt,[e("div",es,[e("div",ts,[o[18]||(o[18]=e("label",{for:"week",class:"text-sm font-medium"},"Week:",-1)),E(e("select",{id:"week","onUpdate:modelValue":o[2]||(o[2]=l=>S.value=l),onChange:x,class:"h-10 w-20 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(i(!0),a(F,null,O(m.value,l=>(i(),a("option",{key:l,value:l},u(l),9,ss))),128))],544),[[L,S.value,void 0,{number:!0}]])]),e("div",os,[o[19]||(o[19]=e("label",{for:"year",class:"text-sm font-medium"},"Year:",-1)),E(e("select",{id:"year","onUpdate:modelValue":o[3]||(o[3]=l=>v.value=l),onChange:x,class:"h-10 w-24 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(i(!0),a(F,null,O(D.value,l=>(i(),a("option",{key:l,value:l},u(l),9,ls))),128))],544),[[L,v.value,void 0,{number:!0}]])]),e("div",rs,[o[21]||(o[21]=e("label",{for:"group-filter",class:"text-sm font-medium"},"Group:",-1)),E(e("select",{id:"group-filter","onUpdate:modelValue":o[4]||(o[4]=l=>g.value=l),onChange:n,class:"h-10 w-[200px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[o[20]||(o[20]=e("option",{value:""},"All Groups",-1)),(i(!0),a(F,null,O(c.groups,l=>(i(),a("option",{key:l.id,value:String(l.id)},u(l.name),9,ns))),128))],544),[[L,g.value]])]),e("div",is,[r(t(ne),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),r(t(N),{modelValue:_.value,"onUpdate:modelValue":o[5]||(o[5]=l=>_.value=l),onInput:s,type:"search",placeholder:"Search by client or menu name...",class:"pl-9"},null,8,["modelValue"])])]),c.groupedOrders.length>0?(i(),a("div",as,[e("div",ds,[o[22]||(o[22]=e("div",{class:"text-sm text-muted-foreground"},"Total Orders",-1)),e("div",us," €"+u(c.groupedOrders.reduce((l,M)=>l+M.total,0).toFixed(2)),1)])])):C("",!0)]),e("div",cs,[e("div",ms,[e("div",vs,[o[23]||(o[23]=e("label",{for:"week-mobile",class:"text-sm font-medium"},"Week",-1)),E(e("select",{id:"week-mobile","onUpdate:modelValue":o[6]||(o[6]=l=>S.value=l),onChange:x,class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(i(!0),a(F,null,O(m.value,l=>(i(),a("option",{key:l,value:l},u(l),9,fs))),128))],544),[[L,S.value,void 0,{number:!0}]])]),e("div",ps,[o[24]||(o[24]=e("label",{for:"year-mobile",class:"text-sm font-medium"},"Year",-1)),E(e("select",{id:"year-mobile","onUpdate:modelValue":o[7]||(o[7]=l=>v.value=l),onChange:x,class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[(i(!0),a(F,null,O(D.value,l=>(i(),a("option",{key:l,value:l},u(l),9,bs))),128))],544),[[L,v.value,void 0,{number:!0}]])])]),e("div",gs,[o[26]||(o[26]=e("label",{for:"group-filter-mobile",class:"text-sm font-medium"},"Group",-1)),E(e("select",{id:"group-filter-mobile","onUpdate:modelValue":o[8]||(o[8]=l=>g.value=l),onChange:n,class:"h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[o[25]||(o[25]=e("option",{value:""},"All Groups",-1)),(i(!0),a(F,null,O(c.groups,l=>(i(),a("option",{key:l.id,value:String(l.id)},u(l.name),9,ys))),128))],544),[[L,g.value]])]),e("div",xs,[r(t(ne),{class:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),r(t(N),{modelValue:_.value,"onUpdate:modelValue":o[9]||(o[9]=l=>_.value=l),onInput:s,type:"search",placeholder:"Search...",class:"pl-9"},null,8,["modelValue"])]),c.groupedOrders.length>0?(i(),a("div",ws,[o[27]||(o[27]=e("span",{class:"text-sm font-medium"},"Total Orders",-1)),e("span",ks," €"+u(c.groupedOrders.reduce((l,M)=>l+M.total,0).toFixed(2)),1)])):C("",!0)])],512),[[xe,p.value]]),c.groupedOrders.length===0?(i(),a("div",_s," No orders found for the selected filters. ")):C("",!0),e("div",hs,[(i(!0),a(F,null,O(c.groupedOrders,l=>(i(),H(t(Ve),{key:l.user.id,class:"border-l-4 border-blue-400 bg-linear-to-br from-blue-50/50 via-white to-orange-50/30 hover:shadow-lg transition-shadow"},{default:d(()=>[r(t(Fe),{class:"bg-linear-to-r from-blue-50 to-orange-50 border-b border-blue-100"},{default:d(()=>[e("div",$s,[e("div",Cs,[r(t(Oe),{class:"text-blue-900"},{default:d(()=>[k(u(l.user.name),1)]),_:2},1024),r(t(Ue),null,{default:d(()=>[e("div",Vs,[e("div",Ss,[o[28]||(o[28]=e("span",{class:"inline-block w-2 h-2 bg-orange-400 rounded-full"},null,-1)),e("span",null,u(l.group?.name??"No Group"),1)]),e("div",Us,u(w(l.order_date)),1)])]),_:2},1024)]),e("div",Fs,[r(t(A),{size:"sm",variant:"ghost",onClick:M=>ce(l),class:"hover:bg-blue-100 hover:text-blue-700"},{default:d(()=>[r(t(De),{class:"h-4 w-4"})]),_:1},8,["onClick"]),r(t(A),{size:"sm",variant:"ghost",onClick:M=>ve(l),class:"hover:bg-orange-100 hover:text-orange-700"},{default:d(()=>[r(t(qe),{class:"h-4 w-4"})]),_:1},8,["onClick"])])])]),_:2},1024),r(t(Se),null,{default:d(()=>[e("div",Os,[Q(l.orders).length>0?(i(),a("div",qs,[o[29]||(o[29]=e("div",{class:"font-medium mb-1 text-yellow-800"},"Notes:",-1)),(i(!0),a(F,null,O(Q(l.orders),(M,pe)=>(i(),a("div",{key:pe,class:"text-yellow-700"}," • "+u(M),1))),128)),o[30]||(o[30]=e("div",{class:"border-t border-yellow-200 mt-3 mb-3"},null,-1))])):C("",!0),(i(!0),a(F,null,O(l.orders,M=>(i(),a("div",{key:M.id,class:"flex justify-between text-sm hover:bg-blue-50 p-2 rounded transition-colors"},[e("div",Ds,[e("span",Ts,u(M.quantity)+"×",1),e("span",js,u(M.weekmenu.menu.label),1)]),e("div",Ms," €"+u(le(M).toFixed(2)),1)]))),128)),o[32]||(o[32]=e("div",{class:"border-t border-blue-200"},null,-1)),e("div",As,[o[31]||(o[31]=e("span",{class:"text-gray-700"},"Total",-1)),e("span",Is," €"+u(l.total.toFixed(2)),1)])])]),_:2},1024)]),_:2},1024))),128))])])]),_:1}),r(t(Z),{open:Y.value,"onUpdate:open":o[11]||(o[11]=l=>Y.value=l)},{default:d(()=>[r(t(ee),{class:"max-w-md"},{default:d(()=>[r(t(te),null,{default:d(()=>[r(t(se),null,{default:d(()=>[...o[33]||(o[33]=[k("Add Order",-1)])]),_:1}),r(t(oe),null,{default:d(()=>[...o[34]||(o[34]=[k("Create a new order for a client",-1)])]),_:1})]),_:1}),r(ue,{week:c.currentWeek,year:c.currentYear,menus:c.menus,groups:c.groups,onSuccess:y,onCancel:o[10]||(o[10]=l=>Y.value=!1)},null,8,["week","year","menus","groups"])]),_:1})]),_:1},8,["open"]),W.value?(i(),H(kt,{key:0,order:W.value,open:R.value,menus:c.menus,groups:c.groups,"onUpdate:open":o[12]||(o[12]=l=>R.value=l),onSuccess:me},null,8,["order","open","menus","groups"])):C("",!0),X.value?(i(),H(Qt,{key:1,order:X.value,open:J.value,"onUpdate:open":o[13]||(o[13]=l=>J.value=l),onSuccess:fe},null,8,["order","open"])):C("",!0)],64))}});export{ro as default};
